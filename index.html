<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>EMPIRE HOCKEY</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{background:#020b18;font-family:'Rajdhani',sans-serif;color:#d4f8ff;overflow-x:hidden}
::-webkit-scrollbar{width:4px;background:#061428}
::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#4dd9f5,#6e3fa3);border-radius:2px}
.ice-bg{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
.ice-bg::before{content:'';position:absolute;inset:0;
  background:radial-gradient(ellipse 90% 50% at 15% 5%,rgba(110,63,163,.22),transparent 55%),
    radial-gradient(ellipse 70% 70% at 85% 95%,rgba(26,111,166,.26),transparent 55%),
    linear-gradient(180deg,#020b18,#050f1e 30%,#030e20 70%,#020a16);
}
.ice-bg::after{content:'';position:absolute;inset:0;
  background-image:repeating-linear-gradient(0deg,transparent,transparent 79px,rgba(77,217,245,.035) 80px),
    repeating-linear-gradient(90deg,transparent,transparent 79px,rgba(77,217,245,.025) 80px);
  animation:rinkShimmer 10s ease-in-out infinite alternate}
@keyframes rinkShimmer{0%{opacity:.6}100%{opacity:1}}
.aurora-curtain{position:absolute;bottom:0;left:0;right:0;height:2px;opacity:.6;background:linear-gradient(90deg,transparent,#1a6fa6 20%,#4dd9f5 40%,rgba(212,248,255,.8) 50%,#4dd9f5 70%,transparent)}
@keyframes revealUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:none}}
.reveal{animation:revealUp .45s cubic-bezier(.22,1,.36,1) both}

/* LOCK */
#lock-screen{position:fixed;inset:0;z-index:500;display:flex;align-items:center;justify-content:center;
  background:radial-gradient(ellipse 80% 70% at 50% 40%,rgba(13,40,80,.45),#020b18 68%)}
.lock-box{width:320px;padding:40px 32px;background:rgba(5,16,34,.96);border:1px solid rgba(240,200,74,.22);
  border-radius:20px;box-shadow:0 0 60px rgba(0,0,0,.85),0 0 120px rgba(240,200,74,.05);text-align:center;
  animation:revealUp .5s cubic-bezier(.22,1,.36,1) both}
.lock-input{width:100%;padding:12px;background:rgba(255,255,255,.04);border:1px solid rgba(77,217,245,.25);
  border-radius:10px;color:#d4f8ff;font-size:20px;text-align:center;letter-spacing:6px;outline:none;
  font-family:'Cinzel',serif;transition:all .2s}
.lock-input:focus{border-color:rgba(77,217,245,.6);box-shadow:0 0 0 3px rgba(77,217,245,.1)}
.lock-input.error{border-color:rgba(255,68,102,.6);animation:shake .35s}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-9px)}75%{transform:translateX(9px)}}
.lock-btn{width:100%;padding:13px;border-radius:10px;border:1px solid rgba(240,200,74,.4);
  background:linear-gradient(135deg,rgba(240,200,74,.1),rgba(240,200,74,.05));
  color:#f0c84a;font-family:'Cinzel',serif;font-size:13px;font-weight:700;letter-spacing:3px;cursor:pointer;transition:all .2s}
.lock-btn:hover{border-color:rgba(240,200,74,.7);background:rgba(240,200,74,.15)}

/* HUB */
#hub{display:none;min-height:100vh;position:relative;z-index:1;padding:60px 24px}
.hub-title{font-family:'Cinzel',serif;font-size:clamp(24px,5vw,44px);font-weight:900;letter-spacing:6px;
  background:linear-gradient(135deg,#4dd9f5,#d4f8ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hub-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:24px;max-width:900px;margin:0 auto}
.hub-card{position:relative;overflow:hidden;padding:36px 22px 28px;border-radius:18px;cursor:pointer;
  text-align:center;border:2px solid rgba(255,255,255,.07);background:rgba(5,16,34,.85);
  transition:transform .25s cubic-bezier(.22,1,.36,1),border-color .25s,box-shadow .25s}
.hub-card:hover{transform:translateY(-7px)}

/* DASHBOARD */
#dashboard{display:none;min-height:100vh;position:relative;z-index:1}
header.dash-hdr{background:linear-gradient(180deg,rgba(2,11,24,.98),rgba(4,16,32,.96));
  backdrop-filter:blur(24px);position:sticky;top:0;z-index:100;
  padding:12px 24px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
.nav-btn{padding:7px 16px;border-radius:6px;background:transparent;font-family:'Rajdhani',sans-serif;
  font-size:11px;font-weight:700;letter-spacing:2px;cursor:pointer;transition:all .2s}
.tab-content{animation:tabSlide .3s ease both}
@keyframes tabSlide{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:none}}

/* TABLE */
.data-table{width:100%;border-collapse:collapse;min-width:700px}
.data-table th{padding:8px 10px;font-size:10px;letter-spacing:2px;font-weight:700;cursor:pointer;user-select:none;white-space:nowrap}
.data-table td{padding:9px 10px;font-size:12px;border-bottom:1px solid rgba(77,217,245,.05)}
.hrow{transition:background .12s}.hrow:hover{background:rgba(77,217,245,.06)!important}

/* PLAYERS */
.top-card{background:rgba(6,20,40,.85);border:1px solid rgba(77,217,245,.12);border-radius:12px;overflow:hidden}
.top-card-hdr{padding:12px 16px;background:linear-gradient(135deg,rgba(77,217,245,.07),transparent);border-bottom:1px solid rgba(77,217,245,.1)}

/* MATCH VIEW */
.strength-bar{height:8px;border-radius:4px;transition:width .8s cubic-bezier(.22,1,.36,1)}
.calc-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px}
.calc-cell{text-align:center;padding:12px 8px;background:rgba(6,20,40,.7);border:1px solid rgba(77,217,245,.08);border-radius:10px}

/* VALUE BET */
.vb-input{background:rgba(255,255,255,.05);border:1px solid rgba(77,217,245,.2);border-radius:7px;
  color:#d4f8ff;font-family:'Rajdhani',sans-serif;font-size:15px;font-weight:700;padding:7px 10px;
  width:100%;text-align:center;outline:none;transition:border-color .2s,-webkit-appearance:none;
  -moz-appearance:textfield}
.vb-input::-webkit-inner-spin-button,.vb-input::-webkit-outer-spin-button{-webkit-appearance:none}
.vb-input:focus{border-color:rgba(77,217,245,.7)}
.vb-input.has-val{border-color:rgba(240,200,74,.5)}
.float-vb-btn{position:fixed;bottom:28px;right:28px;z-index:190;width:58px;height:58px;border-radius:50%;
  background:linear-gradient(135deg,#1a6fa6,#0d4a7a);border:2px solid rgba(240,200,74,.45);
  display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1px;cursor:pointer;
  box-shadow:0 4px 20px rgba(0,0,0,.6),0 0 18px rgba(77,217,245,.25);transition:all .25s}
.float-vb-btn:hover{transform:scale(1.1)}
.float-vb-btn.has-value{background:linear-gradient(135deg,#00f5a0,#00b374);border-color:rgba(0,245,160,.7)}
.float-drawer{position:fixed;bottom:100px;right:24px;z-index:191;width:340px;max-height:85vh;overflow-y:auto;
  background:rgba(4,14,30,.97);border:1px solid rgba(77,217,245,.25);border-radius:16px;
  box-shadow:0 12px 40px rgba(0,0,0,.7),0 0 30px rgba(77,217,245,.1);
  animation:slideUp .3s cubic-bezier(.22,1,.36,1) both}
@keyframes slideUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:none}}
@keyframes valueGlow{0%,100%{box-shadow:0 0 12px rgba(0,245,160,.4),0 0 30px rgba(0,245,160,.15)}50%{box-shadow:0 0 24px rgba(0,245,160,.8),0 0 50px rgba(0,245,160,.35)}}
.value-glow{animation:valueGlow 2s ease-in-out infinite}
@keyframes visionPulse{0%,100%{box-shadow:0 0 8px rgba(240,200,74,.5),0 0 20px rgba(240,200,74,.2)}50%{box-shadow:0 0 14px rgba(240,200,74,.9),0 0 30px rgba(240,200,74,.5)}}
.vision-badge{display:inline-flex;align-items:center;gap:3px;background:linear-gradient(135deg,rgba(240,200,74,.18),rgba(255,224,122,.08));
  border:1px solid rgba(240,200,74,.5);border-radius:10px;padding:2px 8px;font-size:10px;font-weight:800;
  color:#f0c84a;letter-spacing:1px;font-family:'Cinzel',serif;animation:visionPulse 2.5s ease-in-out infinite}
@keyframes firePulse{0%,100%{box-shadow:0 0 10px rgba(255,107,0,.4)}50%{box-shadow:0 0 24px rgba(255,107,0,.85)}}
.fire-badge{animation:firePulse 2s ease-in-out infinite}
.goals-badge{display:inline-flex;align-items:background:linear-gradient(135deg,rgba(0,245,160,.12),rgba(0,245,160,.04));
  border:1px solid rgba(0,245,160,.4);border-radius:8px;padding:3px 10px;font-size:11px;font-weight:700;color:#00f5a0}
.goals-badge{display:inline-flex;align-items:center;background:linear-gradient(135deg,rgba(0,245,160,.12),rgba(0,245,160,.04));
  border:1px solid rgba(0,245,160,.4);border-radius:8px;padding:3px 10px;font-size:11px;font-weight:700;color:#00f5a0}

/* SYNC */
.sync-overlay{position:fixed;inset:0;background:rgba(2,11,24,.98);z-index:200;overflow-y:auto;padding:30px 24px}
.sync-ta{width:100%;font-family:'Rajdhani',monospace;font-size:12px;background:rgba(255,255,255,.03);
  border:1px solid rgba(77,217,245,.18);border-radius:10px;color:#a8f0ff;padding:14px;resize:vertical;
  outline:none;transition:border-color .2s;line-height:1.65;min-height:160px}
.sync-ta:focus{border-color:rgba(77,217,245,.55)}
.sync-ta.ok{border-color:rgba(0,245,160,.5)}
.sync-ta.err{border-color:rgba(255,68,102,.4)}
.sync-btn{font-family:'Cinzel',serif;font-size:13px;font-weight:900;letter-spacing:3px;padding:14px 36px;
  border:1px solid rgba(240,200,74,.5);border-radius:10px;background:linear-gradient(135deg,rgba(240,200,74,.12),rgba(240,200,74,.06));
  color:#f0c84a;cursor:pointer;transition:all .2s}
.sync-btn:hover{border-color:rgba(240,200,74,.8);box-shadow:0 0 20px rgba(240,200,74,.25)}
.sync-btn:disabled{opacity:.4;cursor:not-allowed}
.nhl-manual-overlay{position:fixed;inset:0;background:rgba(2,11,24,.98);z-index:300;overflow-y:auto;padding:30px 24px;display:none}
.nhl-manual-ta{width:100%;font-family:'Rajdhani',monospace;font-size:12px;background:rgba(255,255,255,.03);border:1px solid rgba(255,68,102,.3);border-radius:10px;color:#e0f4ff;padding:14px;resize:vertical;outline:none;box-sizing:border-box;line-height:1.5}
.nhl-manual-ta:focus{border-color:rgba(0,245,160,.5)}
.nhl-manual-ta.ok{border-color:rgba(0,245,160,.5);background:rgba(0,245,160,.04)}
.nhl-manual-ta.err{border-color:rgba(255,68,102,.5)}
.empire-divider{height:1px;background:linear-gradient(90deg,transparent,rgba(77,217,245,.25),transparent);margin:16px 0}
.pos-tag{display:inline-block;padding:1px 6px;border-radius:3px;font-size:10px;font-weight:800}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
/* Snowflakes */
.snow{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden}
</style>
</head>
<body>
<div class="ice-bg"></div>
<div class="snow" id="snow"></div>

<!-- LOCK -->
<div id="lock-screen">
  <div class="lock-box">
    <div style="font-size:40px;margin-bottom:10px;filter:drop-shadow(0 0 16px #4dd9f5)">üèí</div>
    <div style="font-family:'Cinzel',serif;font-size:22px;font-weight:900;letter-spacing:5px;color:#4dd9f5;margin-bottom:4px">EMPIRE</div>
    <div style="font-size:9px;letter-spacing:6px;color:rgba(77,217,245,.4);margin-bottom:28px">HOCKEY ANALYTICS</div>
    <input class="lock-input" id="pin-input" type="password" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="off"/>
    <div id="pin-error" style="height:18px;font-size:11px;color:#ff4466;letter-spacing:2px;margin:8px 0;opacity:0;transition:opacity .3s">CODE INCORRECT</div>
    <button class="lock-btn" onclick="tryUnlock()">ACC√âDER</button>
  </div>
</div>

<!-- HUB -->
<div id="hub">
  <div style="text-align:center;margin-bottom:48px">
    <div style="font-size:10px;letter-spacing:6px;color:rgba(77,217,245,.4);margin-bottom:8px">EMPIRE HOCKEY ¬∑ 2025-26</div>
    <div class="hub-title">S√âLECTION LIGUE</div>
    <div style="font-size:12px;color:rgba(168,240,255,.3);letter-spacing:3px;margin-top:8px">CHOOSE YOUR LEAGUE</div>
  </div>
  <div class="hub-grid" id="hub-grid"></div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <header class="dash-hdr" id="dash-header">
    <div style="display:flex;align-items:center;gap:14px">
      <button onclick="goHub()" id="back-btn" class="nav-btn" style="border:1px solid #4dd9f544;color:#4dd9f5;font-family:'Cinzel',serif">‚Üê HUB</button>
      <span style="font-size:24px" id="dash-icon">üèí</span>
      <div>
        <div id="dash-title" style="font-family:'Cinzel',serif;font-size:18px;font-weight:900;letter-spacing:6px;color:#4dd9f5"></div>
        <div style="font-size:8px;letter-spacing:4px;color:rgba(77,217,245,.4)">EMPIRE ¬∑ 2025-26</div>
      </div>
      <button onclick="S.league==='nhl'?openNHLManual():openSync()" class="nav-btn" id="sync-btn" style="border:1px solid #4dd9f566;color:#4dd9f5;background:rgba(77,217,245,.08);display:flex;align-items:center;gap:6px"><span>‚ö°</span> SYNC</button>
    </div>
    <nav style="display:flex;gap:6px">
      <button class="nav-btn" id="nav-standings" onclick="setView('standings')">üèÜ Classement</button>
      <button class="nav-btn" id="nav-schedule" onclick="setView('schedule')">‚ùÑ Calendrier</button>
      <button class="nav-btn" id="nav-players" onclick="setView('players')">‚ú¶ Joueurs</button>
    </nav>
    <div style="display:flex;align-items:center;gap:12px">
      <span id="upcoming-count" style="font-size:11px;letter-spacing:1px;color:rgba(77,217,245,.6)"></span>
      <div style="text-align:right">
        <div id="current-date" style="font-size:10px;letter-spacing:1px;color:rgba(77,217,245,.5);text-transform:capitalize"></div>
        <div id="dash-clock" style="font-family:'Cinzel',serif;font-size:13px;letter-spacing:2px;color:#4dd9f5"></div>
      </div>
    </div>
    <div class="aurora-curtain" id="aurora-line"></div>
  </header>
  <div style="max-width:1120px;margin:0 auto;padding:24px 20px" id="view-container" class="reveal"></div>
</div>

<!-- OVERLAY CHARGEMENT MANUEL NHL -->
<div class="nhl-manual-overlay" id="nhl-manual-overlay">
  <div class="ice-bg"></div>
  <div style="position:relative;z-index:1;max-width:960px;margin:0 auto;width:100%">
    <div style="text-align:center;margin-bottom:28px">
      <div style="font-family:'Cinzel',serif;font-size:26px;font-weight:900;letter-spacing:5px;color:#4dd9f5">INJECTION DONN√âES NHL</div>
      <div style="font-size:11px;color:rgba(77,217,245,.4);letter-spacing:2px;margin-top:8px">Colle le JSON brut de l'API NHL dans les zones ci-dessous</div>
    </div>
    <div style="background:rgba(77,217,245,.05);border:1px solid rgba(77,217,245,.15);border-radius:12px;padding:16px 20px;margin-bottom:22px;font-size:12px;color:rgba(168,240,255,.7);line-height:1.9">
      <strong style="color:#4dd9f5;letter-spacing:2px">INSTRUCTIONS :</strong><br>
      1. Ouvre ces URLs dans un autre onglet &rarr;
      <a href="https://api-web.nhle.com/v1/standings/now" target="_blank" style="color:#4dd9f5;font-family:monospace">standings/now</a> &nbsp;
      <a href="https://api-web.nhle.com/v1/schedule/now" target="_blank" style="color:#f0c84a;font-family:monospace">schedule/now</a> &nbsp;
      <a href="https://api-web.nhle.com/v1/skater-stats-leaders/current?categories=goals&limit=25" target="_blank" style="color:#00f5a0;font-family:monospace">leaders/goals</a> &nbsp;
      <a href="https://api-web.nhle.com/v1/skater-stats-leaders/current?categories=assists&limit=25" target="_blank" style="color:#4dd9f5;font-family:monospace">leaders/assists</a> &nbsp;
      <a href="https://api-web.nhle.com/v1/skater-stats-leaders/current?categories=points&limit=25" target="_blank" style="color:#f0c84a;font-family:monospace">leaders/points</a><br>
      2. Copie tout le contenu (Ctrl+A puis Ctrl+C)<br>
      3. Colle dans la zone correspondante puis clique <strong style="color:#f0c84a">APPLIQUER</strong>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">
      <div>
        <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:#4dd9f5;margin-bottom:8px">STANDINGS</div>
        <textarea class="nhl-manual-ta" id="nhl-json-standings" placeholder="Colle ici le JSON de&#10;/v1/standings/now" rows="12" oninput="nhlManualValidate('standings')" onpaste="setTimeout(()=>nhlManualValidate('standings'),50)"></textarea>
        <div id="nhl-tag-standings" style="font-size:10px;letter-spacing:1px;margin-top:5px;min-height:16px"></div>
      </div>
      <div>
        <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:#f0c84a;margin-bottom:8px">SCHEDULE</div>
        <textarea class="nhl-manual-ta" id="nhl-json-schedule" placeholder="Colle ici le JSON de&#10;/v1/schedule/now" rows="12" oninput="nhlManualValidate('schedule')" onpaste="setTimeout(()=>nhlManualValidate('schedule'),50)"></textarea>
        <div id="nhl-tag-schedule" style="font-size:10px;letter-spacing:1px;margin-top:5px;min-height:16px"></div>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;margin-bottom:22px">
      <div>
        <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:#00f5a0;margin-bottom:6px">ü•Ö TEXTE BUTS</div>
        <div style="font-size:9px;color:rgba(0,245,160,.4);letter-spacing:1px;margin-bottom:8px">leaders/goals</div>
        <textarea class="nhl-manual-ta" id="nhl-json-goals" placeholder="Colle ici le JSON de&#10;?categories=goals" rows="12" oninput="nhlManualValidate('goals')" onpaste="setTimeout(()=>nhlManualValidate('goals'),50)" style="border-color:rgba(0,245,160,.3)"></textarea>
        <div id="nhl-tag-goals" style="font-size:10px;letter-spacing:1px;margin-top:5px;min-height:16px"></div>
      </div>
      <div>
        <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:#4dd9f5;margin-bottom:6px">üéØ TEXTE PASSES</div>
        <div style="font-size:9px;color:rgba(77,217,245,.4);letter-spacing:1px;margin-bottom:8px">leaders/assists</div>
        <textarea class="nhl-manual-ta" id="nhl-json-assists" placeholder="Colle ici le JSON de&#10;?categories=assists" rows="12" oninput="nhlManualValidate('assists')" onpaste="setTimeout(()=>nhlManualValidate('assists'),50)" style="border-color:rgba(77,217,245,.3)"></textarea>
        <div id="nhl-tag-assists" style="font-size:10px;letter-spacing:1px;margin-top:5px;min-height:16px"></div>
      </div>
      <div>
        <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:#f0c84a;margin-bottom:6px">‚≠ê TEXTE POINTS</div>
        <div style="font-size:9px;color:rgba(240,200,74,.4);letter-spacing:1px;margin-bottom:8px">leaders/points</div>
        <textarea class="nhl-manual-ta" id="nhl-json-players" placeholder="Colle ici le JSON de&#10;?categories=points" rows="12" oninput="nhlManualValidate('players')" onpaste="setTimeout(()=>nhlManualValidate('players'),50)" style="border-color:rgba(240,200,74,.3)"></textarea>
        <div id="nhl-tag-players" style="font-size:10px;letter-spacing:1px;margin-top:5px;min-height:16px"></div>
      </div>
    </div>
    <div style="display:flex;gap:14px;justify-content:center;flex-wrap:wrap">
      <button class="sync-btn" id="nhl-manual-apply-btn" onclick="nhlManualApply()" disabled style="opacity:0.4;cursor:not-allowed">COLLE AU MOINS UN CHAMP D'ABORD</button>
      <button onclick="closeNHLManual()" style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:2px;padding:14px 24px;border:1px solid rgba(77,217,245,.2);border-radius:10px;background:transparent;color:rgba(77,217,245,.4);cursor:pointer">FERMER</button>
    </div>
  </div>
</div>

<div class="sync-overlay" id="sync-overlay" style="display:none">
  <div class="ice-bg"></div>
  <div style="position:relative;z-index:1;max-width:1280px;margin:0 auto;width:100%">
    <div style="text-align:center;margin-bottom:24px">
      <div id="sync-title" style="font-family:'Cinzel',serif;font-size:26px;font-weight:900;letter-spacing:5px;color:#4dd9f5">‚ö° INJECTION DONN√âES</div>
      <div id="sync-subtitle" style="font-size:11px;color:rgba(168,240,255,.4);letter-spacing:2px;margin-top:6px">Standings ¬∑ Buts ¬∑ Passes ¬∑ Points ¬∑ Calendrier</div>
    </div>

    <!-- LIGNE 1 : Standings + Schedule c√¥te √† c√¥te -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-bottom:18px">

      <!-- STANDINGS -->
      <div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
          <div style="display:flex;align-items:center;gap:8px">
            <div style="width:26px;height:26px;border-radius:7px;background:rgba(77,217,245,.15);border:1px solid rgba(77,217,245,.4);display:flex;align-items:center;justify-content:center;font-size:13px">üèÜ</div>
            <div>
              <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:#4dd9f5">STANDINGS</div>
              <div style="font-size:9px;color:rgba(77,217,245,.4);letter-spacing:2px">CLASSEMENT √âQUIPES</div>
            </div>
          </div>
          <div id="tag-standings" style="padding:3px 10px;border-radius:5px;font-size:10px;font-weight:700;letter-spacing:1px;display:none"></div>
        </div>
        <textarea class="sync-ta" id="zone-standings" placeholder="Colle ici le classement (JSON ou texte)&#10;standings/now" rows="9" oninput="parseSyncField('standings')" onpaste="setTimeout(()=>parseSyncField('standings'),50)" style="border-color:rgba(77,217,245,.25)"></textarea>
        <button onclick="clearSyncField('standings')" style="margin-top:5px;font-size:10px;color:rgba(255,68,102,.5);background:none;border:none;cursor:pointer;letter-spacing:1px">üóë Effacer</button>
      </div>

      <!-- ZONE B : SCHEDULE (inchang√©e, toujours l√†) -->
      <div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
          <div style="display:flex;align-items:center;gap:8px">
            <div style="width:26px;height:26px;border-radius:7px;background:rgba(240,200,74,.1);border:1px solid rgba(240,200,74,.35);display:flex;align-items:center;justify-content:center;font-size:13px">üìÖ</div>
            <div>
              <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:#f0c84a">ZONE B ‚Äî CALENDRIER</div>
              <div style="font-size:9px;color:rgba(240,200,74,.5);letter-spacing:2px">FUTURS MATCHS ¬∑ üíæ AUTO-SAUVEGARD√â</div>
            </div>
          </div>
          <div id="zb-tag" style="padding:3px 10px;border-radius:5px;font-size:10px;font-weight:700;letter-spacing:1px;display:none"></div>
        </div>
        <textarea class="sync-ta" id="zone-b" placeholder="ZONE B ‚Äî Futurs matchs&#10;2026-02-25 | √âquipe1 vs √âquipe2 | 19:00&#10;√âquipe3 - √âquipe4 25/02 19:30" rows="9" oninput="parseZoneB()"></textarea>
        <button onclick="clearZoneB()" style="margin-top:5px;font-size:10px;color:rgba(255,68,102,.5);background:none;border:none;cursor:pointer;letter-spacing:1px">üóë Effacer Zone B</button>
      </div>
    </div>

    <!-- LIGNE 2 : Buts ¬∑ Passes ¬∑ Points -->
    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:18px;margin-bottom:24px">

      <!-- BUTS -->
      <div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
          <div style="display:flex;align-items:center;gap:8px">
            <div style="width:26px;height:26px;border-radius:7px;background:rgba(0,245,160,.1);border:1px solid rgba(0,245,160,.35);display:flex;align-items:center;justify-content:center;font-size:13px">ü•Ö</div>
            <div>
              <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:#00f5a0">TEXTE BUTS</div>
              <div style="font-size:9px;color:rgba(0,245,160,.4);letter-spacing:2px">TOP BUTEURS</div>
            </div>
          </div>
          <div id="tag-goals" style="padding:3px 10px;border-radius:5px;font-size:10px;font-weight:700;letter-spacing:1px;display:none"></div>
        </div>
        <textarea class="sync-ta" id="zone-goals" placeholder="Colle ici les leaders en buts&#10;JSON ou texte libre" rows="10" oninput="parseSyncField('goals')" onpaste="setTimeout(()=>parseSyncField('goals'),50)" style="border-color:rgba(0,245,160,.2)"></textarea>
        <button onclick="clearSyncField('goals')" style="margin-top:5px;font-size:10px;color:rgba(255,68,102,.5);background:none;border:none;cursor:pointer;letter-spacing:1px">üóë Effacer</button>
      </div>

      <!-- PASSES -->
      <div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
          <div style="display:flex;align-items:center;gap:8px">
            <div style="width:26px;height:26px;border-radius:7px;background:rgba(77,217,245,.12);border:1px solid rgba(77,217,245,.35);display:flex;align-items:center;justify-content:center;font-size:13px">üéØ</div>
            <div>
              <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:#4dd9f5">TEXTE PASSES</div>
              <div style="font-size:9px;color:rgba(77,217,245,.4);letter-spacing:2px">TOP PASSEURS</div>
            </div>
          </div>
          <div id="tag-assists" style="padding:3px 10px;border-radius:5px;font-size:10px;font-weight:700;letter-spacing:1px;display:none"></div>
        </div>
        <textarea class="sync-ta" id="zone-assists" placeholder="Colle ici les leaders en passes&#10;JSON ou texte libre" rows="10" oninput="parseSyncField('assists')" onpaste="setTimeout(()=>parseSyncField('assists'),50)" style="border-color:rgba(77,217,245,.2)"></textarea>
        <button onclick="clearSyncField('assists')" style="margin-top:5px;font-size:10px;color:rgba(255,68,102,.5);background:none;border:none;cursor:pointer;letter-spacing:1px">üóë Effacer</button>
      </div>

      <!-- POINTS -->
      <div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
          <div style="display:flex;align-items:center;gap:8px">
            <div style="width:26px;height:26px;border-radius:7px;background:rgba(240,200,74,.1);border:1px solid rgba(240,200,74,.35);display:flex;align-items:center;justify-content:center;font-size:13px">‚≠ê</div>
            <div>
              <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:#f0c84a">TEXTE POINTS</div>
              <div style="font-size:9px;color:rgba(240,200,74,.4);letter-spacing:2px">TOP POINTEURS</div>
            </div>
          </div>
          <div id="tag-points" style="padding:3px 10px;border-radius:5px;font-size:10px;font-weight:700;letter-spacing:1px;display:none"></div>
        </div>
        <textarea class="sync-ta" id="zone-points" placeholder="Colle ici les leaders en points&#10;JSON ou texte libre" rows="10" oninput="parseSyncField('points')" onpaste="setTimeout(()=>parseSyncField('points'),50)" style="border-color:rgba(240,200,74,.2)"></textarea>
        <button onclick="clearSyncField('points')" style="margin-top:5px;font-size:10px;color:rgba(255,68,102,.5);background:none;border:none;cursor:pointer;letter-spacing:1px">üóë Effacer</button>
      </div>
    </div>

    <div style="display:flex;gap:14px;justify-content:center;align-items:center;flex-wrap:wrap;margin-bottom:24px">
      <button class="sync-btn" id="sync-apply-btn" onclick="applySync()">COLLE DES DONN√âES D'ABORD</button>
      <button onclick="applyDefaults()" style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:2px;padding:14px 24px;border:1px solid rgba(77,217,245,.3);border-radius:10px;background:transparent;color:rgba(77,217,245,.6);cursor:pointer">‚Ü© DONN√âES PAR D√âFAUT</button>
      <button onclick="closeSync()" style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:2px;padding:14px 24px;border:1px solid rgba(255,68,102,.3);border-radius:10px;background:transparent;color:rgba(255,68,102,.6);cursor:pointer">‚úï FERMER</button>
    </div>
  </div>
</div>

<!-- FLOAT VALUE BET -->
<button class="float-vb-btn" id="float-vb-btn" onclick="toggleVBDrawer()" style="display:none">
  <span style="font-size:22px;line-height:1">üíµ</span>
  <span style="font-size:8px;color:rgba(2,11,24,.9);font-weight:800">BET</span>
</button>
<div class="float-drawer" id="float-drawer" style="display:none">
  <div style="padding:16px 20px 12px;border-bottom:1px solid rgba(77,217,245,.1);display:flex;align-items:center;justify-content:space-between">
    <div style="display:flex;align-items:center;gap:10px">
      <span style="font-size:20px">üíµ</span>
      <div>
        <div style="font-family:'Cinzel',serif;font-size:12px;font-weight:700;letter-spacing:3px;color:#f0c84a">CALCULATEUR VALUE BET</div>
        <div id="vb-hint" style="font-size:10px;color:rgba(168,240,255,.4);margin-top:1px">Cote victoire d'une √©quipe</div>
      </div>
    </div>
    <button onclick="toggleVBDrawer()" style="background:none;border:1px solid rgba(77,217,245,.2);border-radius:5px;color:rgba(77,217,245,.6);cursor:pointer;padding:4px 10px;font-size:10px">‚úï</button>
  </div>
  <div style="padding:16px 20px">
    <div style="margin-bottom:14px">
      <div style="font-size:9px;letter-spacing:2px;color:rgba(77,217,245,.5);margin-bottom:7px;font-weight:700">TYPE DE PARI</div>
      <div style="display:flex;gap:6px">
        <button onclick="setVBType('victoire')" id="vbt-victoire" class="bet-type-tab active" style="flex:1;padding:7px 4px;border-radius:6px;cursor:pointer;font-size:10px;font-weight:700;letter-spacing:1px;border:1px solid rgba(77,217,245,.15);background:rgba(77,217,245,.12);color:#4dd9f5">üèÜ Victoire</button>
        <button onclick="setVBType('buteur')" id="vbt-buteur" class="bet-type-tab" style="flex:1;padding:7px 4px;border-radius:6px;cursor:pointer;font-size:10px;font-weight:700;letter-spacing:1px;border:1px solid rgba(77,217,245,.15);background:transparent;color:rgba(168,240,255,.4)">ü•Ö Buteur</button>
        <button onclick="setVBType('passeur')" id="vbt-passeur" class="bet-type-tab" style="flex:1;padding:7px 4px;border-radius:6px;cursor:pointer;font-size:10px;font-weight:700;letter-spacing:1px;border:1px solid rgba(77,217,245,.15);background:transparent;color:rgba(168,240,255,.4)">üéØ Passeur</button>
      </div>
    </div>
    <div class="empire-divider"></div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px">
      <div>
        <div style="font-size:9px;letter-spacing:2px;color:rgba(77,217,245,.5);margin-bottom:5px;font-weight:700">COTE BOOKMAKER</div>
        <input type="number" class="vb-input" id="vb-cote" placeholder="ex: 2.10" step="0.05" min="1.01" oninput="calcVB()"/>
      </div>
      <div>
        <div style="font-size:9px;letter-spacing:2px;color:rgba(168,240,255,.5);margin-bottom:5px;font-weight:700">PROBABILIT√â <span style="color:#f0c84a">(%)</span></div>
        <input type="number" class="vb-input" id="vb-prob" placeholder="ex: 58" step="1" min="1" max="100" oninput="calcVB()"/>
      </div>
    </div>
    <div id="vb-result" style="padding:20px;text-align:center;background:rgba(6,20,40,.4);border-radius:10px;border:1px solid rgba(77,217,245,.07);margin-bottom:12px">
      <div style="font-size:13px;color:rgba(168,240,255,.3);letter-spacing:2px">‚Üë Entre la cote et la probabilit√©</div>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-size:9px;color:rgba(168,240,255,.25)">üí° Kelly √ó 0.4 ¬∑ Max 5% du capital</div>
      <button onclick="resetVB()" style="background:none;border:1px solid rgba(255,68,102,.25);border-radius:5px;color:rgba(255,68,102,.5);cursor:pointer;font-size:9px;padding:3px 8px">‚Ü∫ RESET</button>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const LEAGUES = {
  liiga:{
    id:"liiga",label:"LIIGA",flag:"üá´üáÆ",desc:"Ligue finlandaise ‚Äî SM-liiga 2025-26",
    accent:"#4dd9f5",accentDark:"#1a6fa6",accentShadow:"rgba(77,217,245,.5)",
    lsKey:"empire_liiga_zoneB",teamCount:16,
    abbrevMap:{
      // Noms courts / abr√©viations
      "kal":"KalPa","kalpa":"KalPa","tap":"Tappara","tappara":"Tappara","ilv":"Ilves","ilves":"Ilves",
      "hifk":"HIFK","ifk":"HIFK","kar":"Karpat","karpat":"Karpat","karppat":"Karpat","k√§rp√§t":"Karpat",
      "luk":"Lukko","lukko":"Lukko","tps":"TPS","tps turku":"TPS","pel":"Pelicans","pelicans":"Pelicans",
      "sai":"SaiPa","saipa":"SaiPa","ass":"Assat","assat":"Assat","√§ss√§t":"Assat","spo":"Sport","sport":"Sport",
      "jyp":"JYP","koo":"KooKoo","kookoo":"KooKoo","hpk":"HPK","juk":"Jukurit","jukurit":"Jukurit",
      "kes":"Kiekko","kiekko":"Kiekko","kiekko espoo":"Kiekko","kiekko-espoo":"Kiekko","k-espoo":"Kiekko","kespoo":"Kiekko",
      // Noms complets TheSportsDB (exactement comme retourn√©s par l'API)
      "ifk helsinki":"HIFK","vaasan sport":"Sport","vaasan sp":"Sport","vaasan sporthifk":"Sport",
      "k√§rp√§t oulu":"Karpat","tps turku":"TPS","pelicans lahti":"Pelicans","hpk h√§meenlinna":"HPK",
      "saipa lappeenranta":"SaiPa","jukurit mikkeli":"Jukurit","kalpa kuopio":"KalPa",
      "lukko rauma":"Lukko","ilves tampere":"Ilves","tappara tampere":"Tappara",
      "jyp jyv√§skyl√§":"JYP","kookoo kouvola":"KooKoo","√§ss√§t pori":"Assat",
      "hpk":"HPK","vaasan sp":"Sport",
    },
    teams:[
      {id:"Tappara",name:"Tappara",city:"Tampere",col:"#E31837"},
      {id:"SaiPa",name:"SaiPa",city:"Lappeenranta",col:"#E35205"},
      {id:"JYP",name:"JYP",city:"Jyv√§skyl√§",col:"#004B8D"},
      {id:"KooKoo",name:"KooKoo",city:"Kouvola",col:"#00843D"},
      {id:"Ilves",name:"Ilves",city:"Tampere",col:"#D4A017"},
      {id:"Lukko",name:"Lukko",city:"Rauma",col:"#6B2D8B"},
      {id:"TPS",name:"TPS Turku",city:"Turku",col:"#003DA5"},
      {id:"Karpat",name:"K√§rp√§t",city:"Oulu",col:"#E07000"},
      {id:"Assat",name:"√Ñss√§t",city:"Pori",col:"#8B0000"},
      {id:"HIFK",name:"IFK Helsinki",city:"Helsinki",col:"#C8102E"},
      {id:"Kiekko",name:"Kiekko-Espoo",city:"Espoo",col:"#007A3D"},
      {id:"KalPa",name:"KalPa",city:"Kuopio",col:"#8B6914"},
      {id:"Pelicans",name:"Pelicans",city:"Lahti",col:"#004FA3"},
      {id:"HPK",name:"HPK",city:"H√§meenlinna",col:"#2E8B57"},
      {id:"Jukurit",name:"Jukurit",city:"Mikkeli",col:"#0055A4"},
      {id:"Sport",name:"Vaasan Sport",city:"Vaasa",col:"#B8860B"},
    ],
    defaultStats:{
      Tappara:{gp:51,w:34,l:11,otl:6,pts:74,gf:185,ga:131,streak:"W2",form:[1,1,0,1,0],pct:73,ppPct:23.1,pkPct:84.8,shotsFor:33.5,shotsAgainst:26.2,homeW:19,homeL:5,awayW:15,awayL:12},
      SaiPa:{gp:51,w:31,l:14,otl:6,pts:68,gf:170,ga:140,streak:"L3",form:[0,0,0,1,1],pct:67,ppPct:21.4,pkPct:83.1,shotsFor:31.2,shotsAgainst:27.8,homeW:17,homeL:6,awayW:14,awayL:14},
      JYP:{gp:51,w:30,l:15,otl:6,pts:66,gf:162,ga:138,streak:"W3",form:[1,1,1,0,1],pct:65,ppPct:20.8,pkPct:82.4,shotsFor:30.5,shotsAgainst:28.1,homeW:17,homeL:7,awayW:13,awayL:14},
      KooKoo:{gp:51,w:28,l:17,otl:6,pts:62,gf:158,ga:142,streak:"W4",form:[1,1,1,1,0],pct:61,ppPct:20.1,pkPct:81.7,shotsFor:29.8,shotsAgainst:28.9,homeW:16,homeL:7,awayW:12,awayL:16},
      Ilves:{gp:51,w:27,l:18,otl:6,pts:60,gf:152,ga:144,streak:"W1",form:[1,0,1,0,1],pct:59,ppPct:19.5,pkPct:81.0,shotsFor:29.1,shotsAgainst:29.5,homeW:15,homeL:8,awayW:12,awayL:16},
      Lukko:{gp:51,w:26,l:19,otl:6,pts:58,gf:148,ga:148,streak:"L2",form:[0,0,1,1,0],pct:57,ppPct:18.8,pkPct:80.3,shotsFor:28.4,shotsAgainst:30.2,homeW:15,homeL:8,awayW:11,awayL:17},
      TPS:{gp:51,w:24,l:21,otl:6,pts:54,gf:142,ga:151,streak:"L1",form:[0,1,0,1,0],pct:53,ppPct:18.1,pkPct:79.6,shotsFor:27.7,shotsAgainst:30.9,homeW:14,homeL:9,awayW:10,awayL:18},
      Karpat:{gp:51,w:23,l:22,otl:6,pts:52,gf:138,ga:153,streak:"L3",form:[0,0,0,1,1],pct:51,ppPct:17.4,pkPct:78.9,shotsFor:27.0,shotsAgainst:31.6,homeW:13,homeL:10,awayW:10,awayL:18},
      Assat:{gp:51,w:22,l:23,otl:6,pts:50,gf:134,ga:156,streak:"W1",form:[1,0,0,1,0],pct:49,ppPct:16.7,pkPct:78.2,shotsFor:26.3,shotsAgainst:32.3,homeW:12,homeL:11,awayW:10,awayL:18},
      HIFK:{gp:51,w:21,l:24,otl:6,pts:48,gf:130,ga:159,streak:"L2",form:[0,0,1,0,1],pct:47,ppPct:16.0,pkPct:77.5,shotsFor:25.6,shotsAgainst:33.0,homeW:11,homeL:12,awayW:10,awayL:18},
      Kiekko:{gp:51,w:20,l:25,otl:6,pts:46,gf:126,ga:162,streak:"L1",form:[0,1,0,0,1],pct:45,ppPct:15.3,pkPct:76.8,shotsFor:24.9,shotsAgainst:33.7,homeW:11,homeL:12,awayW:9,awayL:19},
      KalPa:{gp:51,w:19,l:26,otl:6,pts:44,gf:122,ga:165,streak:"W2",form:[1,1,0,0,0],pct:43,ppPct:14.6,pkPct:76.1,shotsFor:24.2,shotsAgainst:34.4,homeW:10,homeL:13,awayW:9,awayL:19},
      Pelicans:{gp:51,w:18,l:27,otl:6,pts:42,gf:118,ga:168,streak:"L3",form:[0,0,0,1,1],pct:41,ppPct:13.9,pkPct:75.4,shotsFor:23.5,shotsAgainst:35.1,homeW:10,homeL:13,awayW:8,awayL:20},
      HPK:{gp:51,w:17,l:28,otl:6,pts:40,gf:114,ga:171,streak:"L1",form:[0,1,0,0,0],pct:39,ppPct:13.2,pkPct:74.7,shotsFor:22.8,shotsAgainst:35.8,homeW:9,homeL:14,awayW:8,awayL:20},
      Jukurit:{gp:51,w:16,l:29,otl:6,pts:38,gf:110,ga:174,streak:"W1",form:[1,0,0,0,1],pct:37,ppPct:12.5,pkPct:74.0,shotsFor:22.1,shotsAgainst:36.5,homeW:9,homeL:14,awayW:7,awayL:21},
      Sport:{gp:51,w:15,l:30,otl:6,pts:36,gf:106,ga:177,streak:"L2",form:[0,0,1,0,0],pct:35,ppPct:11.8,pkPct:73.3,shotsFor:21.4,shotsAgainst:37.2,homeW:8,homeL:15,awayW:7,awayL:21},
    },
    defaultPlayers:[
      {n:"Benjamin Rautiainen",t:"Tappara",nat:"FI",age:25,pos:"F",gp:50,g:28,a:29,pts:57,pim:18,pm:22,ppg:9,ratio:1.140},
      {n:"Joachim Blichfeld",t:"Tappara",nat:"DK",age:26,pos:"F",gp:50,g:25,a:27,pts:52,pim:14,pm:18,ppg:7,ratio:1.040},
      {n:"Leevi Tukiainen",t:"JYP",nat:"FI",age:24,pos:"F",gp:48,g:19,a:25,pts:44,pim:12,pm:14,ppg:6,ratio:0.917},
      {n:"Aleksi Laakso",t:"SaiPa",nat:"FI",age:26,pos:"F",gp:50,g:22,a:20,pts:42,pim:22,pm:10,ppg:8,ratio:0.840},
      {n:"Mikael Py√∂r√§l√§",t:"KooKoo",nat:"FI",age:30,pos:"F",gp:51,g:18,a:22,pts:40,pim:16,pm:12,ppg:5,ratio:0.784},
      {n:"Mikko Kousa",t:"Ilves",nat:"FI",age:28,pos:"D",gp:50,g:8,a:30,pts:38,pim:24,pm:10,ppg:4,ratio:0.760},
      {n:"Ville Petman",t:"Lukko",nat:"FI",age:27,pos:"F",gp:49,g:20,a:18,pts:38,pim:20,pm:8,ppg:7,ratio:0.776},
      {n:"Aleksei M√§kinen",t:"TPS",nat:"FI",age:25,pos:"F",gp:50,g:16,a:20,pts:36,pim:12,pm:6,ppg:4,ratio:0.720},
      {n:"Teemu Pulkkinen",t:"Karpat",nat:"FI",age:31,pos:"F",gp:48,g:18,a:16,pts:34,pim:14,pm:4,ppg:6,ratio:0.708},
      {n:"Tuomas Kiiskinen",t:"HIFK",nat:"FI",age:29,pos:"F",gp:51,g:15,a:18,pts:33,pim:18,pm:2,ppg:3,ratio:0.647},
      {n:"Ville Leskinen",t:"KalPa",nat:"FI",age:26,pos:"D",gp:48,g:5,a:26,pts:31,pim:22,pm:8,ppg:3,ratio:0.646},
      {n:"Miro Karjalainen",t:"HPK",nat:"FI",age:24,pos:"F",gp:50,g:16,a:14,pts:30,pim:10,pm:4,ppg:5,ratio:0.600},
      {n:"Sami Niku",t:"Pelicans",nat:"FI",age:28,pos:"D",gp:49,g:4,a:24,pts:28,pim:16,pm:0,ppg:2,ratio:0.571},
      {n:"Kevin Lankinen",t:"Tappara",nat:"FI",age:29,pos:"G",gp:38,g:0,a:1,pts:1,pim:0,pm:0,ppg:0,ratio:0.026,svPct:0.924,gaa:2.21},
    ]
  },
  ahl:{
    id:"ahl",label:"AHL",flag:"üá∫üá∏",desc:"Ligue am√©ricaine ‚Äî AHL 2025-26",
    accent:"#f0c84a",accentDark:"#b8960e",accentShadow:"rgba(240,200,74,.5)",
    lsKey:"empire_ahl_zoneB",teamCount:32,
    abbrevMap:{
      "her":"Hershey","hershey":"Hershey","hershey bears":"Hershey",
      "pro":"Providence","providence":"Providence","providence bruins":"Providence",
      "cle":"Cleveland","cleveland":"Cleveland","cleveland monsters":"Cleveland",
      "grr":"GrandRapids","grand rapids":"GrandRapids","grand rapids griffins":"GrandRapids",
      "mil":"Milwaukee","milwaukee":"Milwaukee","milwaukee admirals":"Milwaukee",
      "chi":"Chicago","chicago":"Chicago","chicago wolves":"Chicago","wol":"Chicago",
      "roc":"Rochester","rochester":"Rochester","rochester americans":"Rochester",
      "har":"Hartford","hartford":"Hartford","hartford wolf pack":"Hartford",
      "spr":"Springfield","springfield":"Springfield","springfield thunderbirds":"Springfield",
      "bri":"Bridgeport","bridgeport":"Bridgeport","bridgeport islanders":"Bridgeport",
      "lav":"Laval","laval":"Laval","laval rocket":"Laval",
      "bel":"Belleville","belleville":"Belleville","belleville senators":"Belleville",
      "tor":"TorontoMarlies","toronto":"TorontoMarlies","toronto marlies":"TorontoMarlies","mar":"TorontoMarlies",
      "uti":"Utica","utica":"Utica","utica comets":"Utica",
      "leh":"LehighValley","lehigh":"LehighValley","lehigh valley phantoms":"LehighValley",
      "wbs":"WilkesBarre","wilkes":"WilkesBarre","wilkes-barre":"WilkesBarre","wilkes-barre/scranton penguins":"WilkesBarre",
      "col":"Colorado","eag":"Colorado","colorado eagles":"Colorado",
      "tex":"Texas","texas":"Texas","texas stars":"Texas",
      "bak":"Bakersfield","bakersfield":"Bakersfield","bakersfield condors":"Bakersfield",
      "ont":"Ontario","ontario":"Ontario","ontario reign":"Ontario",
      "sjb":"SanJoseB","barracuda":"SanJoseB","san jose barracuda":"SanJoseB",
      "sdg":"SanDiego","sandiego":"SanDiego","san diego gulls":"SanDiego",
      "abb":"Abbotsford","abbotsford":"Abbotsford","abbotsford canucks":"Abbotsford",
      "tuc":"Tucson","tucson":"Tucson","tucson roadrunners":"Tucson",
      "iow":"Iowa","iowa":"Iowa","iowa wild":"Iowa",
      "mb":"Manitoba","manitoba":"Manitoba","manitoba moose":"Manitoba",
      "sys":"Syracuse","syracuse":"Syracuse","syracuse crunch":"Syracuse",
    },
    teams:[
      {id:"Hershey",name:"Hershey Bears",city:"Hershey PA",col:"#862633"},
      {id:"Providence",name:"Providence Bruins",city:"Providence RI",col:"#FFB81C"},
      {id:"Cleveland",name:"Cleveland Monsters",city:"Cleveland OH",col:"#002F6C"},
      {id:"GrandRapids",name:"Grand Rapids Griffins",city:"Grand Rapids MI",col:"#CE1126"},
      {id:"Milwaukee",name:"Milwaukee Admirals",city:"Milwaukee WI",col:"#FFD100"},
      {id:"Chicago",name:"Chicago Wolves",city:"Chicago IL",col:"#8B1C2E"},
      {id:"Rochester",name:"Rochester Americans",city:"Rochester NY",col:"#00285E"},
      {id:"Hartford",name:"Hartford Wolf Pack",city:"Hartford CT",col:"#003087"},
      {id:"Springfield",name:"Springfield Thunderbirds",city:"Springfield MA",col:"#862633"},
      {id:"Bridgeport",name:"Bridgeport Islanders",city:"Bridgeport CT",col:"#F47D30"},
      {id:"Laval",name:"Laval Rocket",city:"Laval QC",col:"#AF1E2D"},
      {id:"Belleville",name:"Belleville Senators",city:"Belleville ON",col:"#E4173F"},
      {id:"TorontoMarlies",name:"Toronto Marlies",city:"Toronto ON",col:"#003E7E"},
      {id:"Utica",name:"Utica Comets",city:"Utica NY",col:"#003E7E"},
      {id:"LehighValley",name:"Lehigh Valley Phantoms",city:"Allentown PA",col:"#F74902"},
      {id:"WilkesBarre",name:"W-B/Scranton Penguins",city:"Scranton PA",col:"#000000"},
      {id:"Colorado",name:"Colorado Eagles",city:"Loveland CO",col:"#6F263D"},
      {id:"Texas",name:"Texas Stars",city:"Cedar Park TX",col:"#006847"},
      {id:"Bakersfield",name:"Bakersfield Condors",city:"Bakersfield CA",col:"#FC4C02"},
      {id:"Ontario",name:"Ontario Reign",city:"Ontario CA",col:"#A2AAAD"},
      {id:"SanJoseB",name:"San Jose Barracuda",city:"San Jose CA",col:"#006D75"},
      {id:"SanDiego",name:"San Diego Gulls",city:"San Diego CA",col:"#FC4C02"},
      {id:"Abbotsford",name:"Abbotsford Canucks",city:"Abbotsford BC",col:"#00843D"},
      {id:"Tucson",name:"Tucson Roadrunners",city:"Tucson AZ",col:"#8C2633"},
      {id:"Iowa",name:"Iowa Wild",city:"Des Moines IA",col:"#154734"},
      {id:"Manitoba",name:"Manitoba Moose",city:"Winnipeg MB",col:"#004C97"},
      {id:"Syracuse",name:"Syracuse Crunch",city:"Syracuse NY",col:"#002868"},
    ],
    defaultStats:{
      Hershey:{gp:50,w:32,l:12,otl:6,pts:70,gf:175,ga:130,streak:"W3",form:[1,1,1,0,1],pct:70,ppPct:22.5,pkPct:84.1,shotsFor:32.1,shotsAgainst:27.4,homeW:18,homeL:5,awayW:14,awayL:13},
      Providence:{gp:50,w:30,l:14,otl:6,pts:66,gf:165,ga:138,streak:"W1",form:[1,0,1,1,0],pct:66,ppPct:21.2,pkPct:83.0,shotsFor:30.8,shotsAgainst:28.0,homeW:16,homeL:7,awayW:14,awayL:13},
      Cleveland:{gp:50,w:28,l:16,otl:6,pts:62,gf:158,ga:142,streak:"L2",form:[0,0,1,1,0],pct:62,ppPct:20.0,pkPct:82.0,shotsFor:29.5,shotsAgainst:29.0,homeW:15,homeL:8,awayW:13,awayL:14},
      GrandRapids:{gp:50,w:27,l:17,otl:6,pts:60,gf:152,ga:145,streak:"W2",form:[1,1,0,1,0],pct:60,ppPct:19.5,pkPct:81.5,shotsFor:29.0,shotsAgainst:29.5,homeW:14,homeL:9,awayW:13,awayL:14},
      Milwaukee:{gp:50,w:26,l:18,otl:6,pts:58,gf:148,ga:148,streak:"L1",form:[0,1,1,0,1],pct:58,ppPct:19.0,pkPct:81.0,shotsFor:28.5,shotsAgainst:30.0,homeW:14,homeL:9,awayW:12,awayL:15},
      Chicago:{gp:50,w:25,l:19,otl:6,pts:56,gf:144,ga:151,streak:"L3",form:[0,0,0,1,1],pct:56,ppPct:18.5,pkPct:80.5,shotsFor:28.0,shotsAgainst:30.5,homeW:13,homeL:10,awayW:12,awayL:15},
      Rochester:{gp:50,w:24,l:20,otl:6,pts:54,gf:140,ga:154,streak:"W2",form:[1,1,0,0,1],pct:54,ppPct:18.0,pkPct:80.0,shotsFor:27.5,shotsAgainst:31.0,homeW:13,homeL:10,awayW:11,awayL:16},
      Hartford:{gp:50,w:23,l:21,otl:6,pts:52,gf:136,ga:157,streak:"W1",form:[1,0,0,1,0],pct:52,ppPct:17.5,pkPct:79.5,shotsFor:27.0,shotsAgainst:31.5,homeW:12,homeL:11,awayW:11,awayL:16},
      Springfield:{gp:50,w:22,l:22,otl:6,pts:50,gf:132,ga:160,streak:"L2",form:[0,0,1,0,1],pct:50,ppPct:17.0,pkPct:79.0,shotsFor:26.5,shotsAgainst:32.0,homeW:12,homeL:11,awayW:10,awayL:17},
      Laval:{gp:50,w:21,l:23,otl:6,pts:48,gf:128,ga:163,streak:"W3",form:[1,1,1,0,0],pct:48,ppPct:16.5,pkPct:78.5,shotsFor:26.0,shotsAgainst:32.5,homeW:11,homeL:12,awayW:10,awayL:17},
      Belleville:{gp:50,w:20,l:24,otl:6,pts:46,gf:124,ga:166,streak:"L1",form:[0,1,0,0,1],pct:46,ppPct:16.0,pkPct:78.0,shotsFor:25.5,shotsAgainst:33.0,homeW:11,homeL:12,awayW:9,awayL:18},
      TorontoMarlies:{gp:50,w:19,l:25,otl:6,pts:44,gf:120,ga:169,streak:"L2",form:[0,0,0,1,0],pct:44,ppPct:15.5,pkPct:77.5,shotsFor:25.0,shotsAgainst:33.5,homeW:10,homeL:13,awayW:9,awayL:18},
      Colorado:{gp:50,w:27,l:17,otl:6,pts:60,gf:154,ga:144,streak:"W1",form:[1,0,1,1,0],pct:60,ppPct:19.8,pkPct:81.2,shotsFor:29.2,shotsAgainst:29.2,homeW:14,homeL:9,awayW:13,awayL:14},
      Texas:{gp:50,w:25,l:19,otl:6,pts:56,gf:146,ga:150,streak:"L1",form:[0,1,0,1,1],pct:56,ppPct:18.8,pkPct:80.2,shotsFor:27.8,shotsAgainst:30.8,homeW:13,homeL:10,awayW:12,awayL:15},
      Bakersfield:{gp:50,w:24,l:20,otl:6,pts:54,gf:142,ga:153,streak:"W2",form:[1,1,0,1,0],pct:54,ppPct:18.3,pkPct:79.8,shotsFor:27.3,shotsAgainst:31.2,homeW:13,homeL:10,awayW:11,awayL:16},
    },
    defaultPlayers:[
      {n:"Hendrix Lapierre",t:"Hershey",nat:"CA",age:22,pos:"F",gp:42,g:18,a:30,pts:48,pim:18,pm:14,ppg:6,ratio:1.143},
      {n:"Chase Priskie",t:"Hershey",nat:"US",age:28,pos:"D",gp:44,g:8,a:28,pts:36,pim:14,pm:10,ppg:4,ratio:0.818},
      {n:"Matthew Poitras",t:"Providence",nat:"CA",age:20,pos:"F",gp:38,g:16,a:25,pts:41,pim:12,pm:8,ppg:5,ratio:1.079},
      {n:"Marc McLaughlin",t:"Providence",nat:"US",age:24,pos:"F",gp:40,g:22,a:18,pts:40,pim:10,pm:12,ppg:8,ratio:1.000},
      {n:"Luca Del Bel Belluz",t:"Cleveland",nat:"CA",age:21,pos:"F",gp:40,g:14,a:22,pts:36,pim:8,pm:6,ppg:4,ratio:0.900},
      {n:"Xavier Bourgault",t:"Laval",nat:"CA",age:22,pos:"F",gp:44,g:24,a:28,pts:52,pim:16,pm:14,ppg:8,ratio:1.182},
      {n:"Jiri Kulich",t:"Rochester",nat:"CZ",age:21,pos:"F",gp:40,g:21,a:19,pts:40,pim:10,pm:10,ppg:7,ratio:1.000},
      {n:"Elmer Soderblom",t:"GrandRapids",nat:"SE",age:23,pos:"F",gp:36,g:19,a:17,pts:36,pim:14,pm:5,ppg:7,ratio:1.000},
      {n:"Dennis Yan",t:"Milwaukee",nat:"CA",age:25,pos:"F",gp:44,g:20,a:24,pts:44,pim:22,pm:8,ppg:6,ratio:1.000},
      {n:"Andrew Agozzino",t:"Colorado",nat:"CA",age:32,pos:"F",gp:44,g:25,a:22,pts:47,pim:20,pm:10,ppg:9,ratio:1.068},
      {n:"Jet Greaves",t:"Cleveland",nat:"CA",age:22,pos:"G",gp:32,g:0,a:1,pts:1,pim:0,pm:0,ppg:0,ratio:0.031,svPct:0.919,gaa:2.42},
    ]
  },
  nhl:{
    id:"nhl",label:"NHL",flag:"üá∫üá∏",desc:"Ligue nationale ‚Äî NHL 2025-26",
    accent:"#ff4466",accentDark:"#cc0033",accentShadow:"rgba(255,68,102,.5)",
    lsKey:"empire_nhl_zoneB",teamCount:32,
    abbrevMap:{"bos":"Boston","boston":"Boston","tor":"Toronto","toronto":"Toronto",
      "mtl":"Montreal","montreal":"Montreal","ott":"Ottawa","ottawa":"Ottawa",
      "buf":"Buffalo","buffalo":"Buffalo","det":"Detroit","detroit":"Detroit",
      "pit":"Pittsburgh","pittsburgh":"Pittsburgh","phi":"Philadelphia","philadelphia":"Philadelphia",
      "njd":"NewJersey","new jersey":"NewJersey","nyi":"NYIslanders","islanders":"NYIslanders",
      "nyr":"NYRangers","rangers":"NYRangers","car":"Carolina","carolina":"Carolina",
      "was":"Washington","washington":"Washington","col":"Colorado","colorado":"Colorado",
      "min":"Minnesota","minnesota":"Minnesota","chi":"Chicago","chicago":"Chicago",
      "stl":"StLouis","st louis":"StLouis","wpg":"Winnipeg","winnipeg":"Winnipeg",
      "nsh":"Nashville","nashville":"Nashville","dal":"Dallas","dallas":"Dallas",
      "edm":"Edmonton","edmonton":"Edmonton","cgy":"Calgary","calgary":"Calgary",
      "van":"Vancouver","vancouver":"Vancouver","sea":"Seattle","seattle":"Seattle",
      "lak":"LAKings","la kings":"LAKings","ana":"Anaheim","anaheim":"Anaheim",
      "sjs":"SanJose","san jose":"SanJose","uta":"Utah","utah":"Utah",
      "vgk":"VegasGolden","vegas":"VegasGolden","fla":"Florida","florida":"Florida",
      "tbl":"TampaBay","tampa":"TampaBay","cbj":"Columbus","columbus":"Columbus"},
    teams:[
      {id:"Boston",name:"Bruins",city:"Boston MA",col:"#FFB81C"},
      {id:"Toronto",name:"Maple Leafs",city:"Toronto ON",col:"#00205B"},
      {id:"Montreal",name:"Canadiens",city:"Montr√©al QC",col:"#AF1E2D"},
      {id:"Ottawa",name:"Senators",city:"Ottawa ON",col:"#C52032"},
      {id:"Buffalo",name:"Sabres",city:"Buffalo NY",col:"#003087"},
      {id:"Detroit",name:"Red Wings",city:"Detroit MI",col:"#CE1126"},
      {id:"Pittsburgh",name:"Penguins",city:"Pittsburgh PA",col:"#FCB514"},
      {id:"Philadelphia",name:"Flyers",city:"Philadelphia PA",col:"#F74902"},
      {id:"NewJersey",name:"Devils",city:"Newark NJ",col:"#CE1126"},
      {id:"NYIslanders",name:"Islanders",city:"Elmont NY",col:"#F47D30"},
      {id:"NYRangers",name:"Rangers",city:"New York NY",col:"#0038A8"},
      {id:"Carolina",name:"Hurricanes",city:"Raleigh NC",col:"#CC0000"},
      {id:"Washington",name:"Capitals",city:"Washington DC",col:"#041E42"},
      {id:"Colorado",name:"Avalanche",city:"Denver CO",col:"#6F263D"},
      {id:"Minnesota",name:"Wild",city:"St Paul MN",col:"#154734"},
      {id:"Chicago",name:"Blackhawks",city:"Chicago IL",col:"#CF0A2C"},
      {id:"StLouis",name:"Blues",city:"St Louis MO",col:"#002F87"},
      {id:"Winnipeg",name:"Jets",city:"Winnipeg MB",col:"#004C97"},
      {id:"Nashville",name:"Predators",city:"Nashville TN",col:"#FFB81C"},
      {id:"Dallas",name:"Stars",city:"Dallas TX",col:"#006847"},
      {id:"Edmonton",name:"Oilers",city:"Edmonton AB",col:"#FC4C02"},
      {id:"Calgary",name:"Flames",city:"Calgary AB",col:"#C8102E"},
      {id:"Vancouver",name:"Canucks",city:"Vancouver BC",col:"#00843D"},
      {id:"Seattle",name:"Kraken",city:"Seattle WA",col:"#99D9D9"},
      {id:"LAKings",name:"Kings",city:"Los Angeles CA",col:"#A2AAAD"},
      {id:"Anaheim",name:"Ducks",city:"Anaheim CA",col:"#FC4C02"},
      {id:"SanJose",name:"Sharks",city:"San Jose CA",col:"#006D75"},
      {id:"Utah",name:"Hockey Club",city:"Salt Lake City UT",col:"#69B3E7"},
      {id:"VegasGolden",name:"Golden Knights",city:"Las Vegas NV",col:"#B4975A"},
      {id:"Florida",name:"Panthers",city:"Sunrise FL",col:"#C8102E"},
      {id:"TampaBay",name:"Lightning",city:"Tampa FL",col:"#003087"},
      {id:"Columbus",name:"Blue Jackets",city:"Columbus OH",col:"#002654"},
    ],
    defaultStats:{
      Boston:{gp:55,w:36,l:14,otl:5,pts:77,gf:195,ga:145,streak:"W3",form:[1,1,1,0,1],pct:70,ppPct:23.5,pkPct:84.5,shotsFor:33.2,shotsAgainst:27.8,homeW:19,homeL:7,awayW:17,awayL:12},
      Toronto:{gp:55,w:33,l:16,otl:6,pts:72,gf:188,ga:152,streak:"L1",form:[0,1,1,1,0],pct:65,ppPct:22.8,pkPct:83.2,shotsFor:32.0,shotsAgainst:28.5,homeW:17,homeL:8,awayW:16,awayL:14},
      Colorado:{gp:55,w:35,l:15,otl:5,pts:75,gf:200,ga:155,streak:"W2",form:[1,1,0,1,1],pct:68,ppPct:24.0,pkPct:83.8,shotsFor:34.0,shotsAgainst:28.0,homeW:18,homeL:7,awayW:17,awayL:13},
      Carolina:{gp:55,w:34,l:14,otl:7,pts:75,gf:185,ga:148,streak:"W4",form:[1,1,1,1,0],pct:68,ppPct:22.1,pkPct:85.0,shotsFor:32.5,shotsAgainst:27.5,homeW:18,homeL:6,awayW:16,awayL:15},
      Edmonton:{gp:55,w:32,l:17,otl:6,pts:70,gf:196,ga:162,streak:"L2",form:[0,0,1,1,1],pct:64,ppPct:25.2,pkPct:82.0,shotsFor:33.8,shotsAgainst:30.0,homeW:17,homeL:8,awayW:15,awayL:15},
      VegasGolden:{gp:55,w:31,l:17,otl:7,pts:69,gf:182,ga:158,streak:"W1",form:[1,0,1,0,1],pct:63,ppPct:21.5,pkPct:83.5,shotsFor:31.5,shotsAgainst:29.0,homeW:17,homeL:8,awayW:14,awayL:16},
      Florida:{gp:55,w:30,l:18,otl:7,pts:67,gf:178,ga:160,streak:"W2",form:[1,1,0,0,1],pct:61,ppPct:21.0,pkPct:83.0,shotsFor:31.0,shotsAgainst:29.5,homeW:16,homeL:9,awayW:14,awayL:16},
      TampaBay:{gp:55,w:29,l:19,otl:7,pts:65,gf:175,ga:162,streak:"L1",form:[0,1,1,0,1],pct:59,ppPct:20.5,pkPct:82.5,shotsFor:30.5,shotsAgainst:30.0,homeW:15,homeL:10,awayW:14,awayL:16},
      Dallas:{gp:55,w:30,l:18,otl:7,pts:67,gf:177,ga:158,streak:"L3",form:[0,0,0,1,1],pct:61,ppPct:21.2,pkPct:82.8,shotsFor:30.8,shotsAgainst:29.2,homeW:16,homeL:9,awayW:14,awayL:16},
      Winnipeg:{gp:55,w:29,l:20,otl:6,pts:64,gf:172,ga:163,streak:"W1",form:[1,0,0,1,0],pct:58,ppPct:20.8,pkPct:82.3,shotsFor:30.2,shotsAgainst:30.5,homeW:15,homeL:10,awayW:14,awayL:16},
      NewJersey:{gp:55,w:28,l:21,otl:6,pts:62,gf:168,ga:165,streak:"W3",form:[1,1,1,0,0],pct:56,ppPct:20.3,pkPct:81.8,shotsFor:29.8,shotsAgainst:31.0,homeW:15,homeL:10,awayW:13,awayL:17},
      NYRangers:{gp:55,w:27,l:22,otl:6,pts:60,gf:164,ga:168,streak:"L2",form:[0,0,1,1,0],pct:55,ppPct:19.8,pkPct:81.3,shotsFor:29.3,shotsAgainst:31.5,homeW:14,homeL:11,awayW:13,awayL:17},
      Washington:{gp:55,w:27,l:21,otl:7,pts:61,gf:166,ga:167,streak:"L1",form:[0,1,0,1,0],pct:55,ppPct:20.0,pkPct:81.5,shotsFor:29.5,shotsAgainst:31.2,homeW:14,homeL:11,awayW:13,awayL:17},
      Minnesota:{gp:55,w:26,l:23,otl:6,pts:58,gf:160,ga:170,streak:"W2",form:[1,1,0,0,1],pct:53,ppPct:19.5,pkPct:81.0,shotsFor:29.0,shotsAgainst:32.0,homeW:14,homeL:11,awayW:12,awayL:18},
      Vancouver:{gp:55,w:27,l:21,otl:7,pts:61,gf:169,ga:164,streak:"W1",form:[1,0,1,1,0],pct:55,ppPct:20.2,pkPct:81.7,shotsFor:29.7,shotsAgainst:31.0,homeW:14,homeL:11,awayW:13,awayL:17},
      Montreal:{gp:55,w:25,l:24,otl:6,pts:56,gf:162,ga:171,streak:"L1",form:[0,1,0,0,1],pct:51,ppPct:18.8,pkPct:80.2,shotsFor:28.8,shotsAgainst:32.0,homeW:13,homeL:12,awayW:12,awayL:18},
    },
    defaultPlayers:[
      {n:"Nathan MacKinnon",t:"Colorado",nat:"CA",age:29,pos:"F",gp:50,g:32,a:58,pts:90,pim:28,pm:22,ppg:12,ratio:1.800},
      {n:"Connor McDavid",t:"Edmonton",nat:"CA",age:28,pos:"F",gp:50,g:28,a:56,pts:84,pim:22,pm:10,ppg:10,ratio:1.680},
      {n:"Nikita Kucherov",t:"TampaBay",nat:"RU",age:31,pos:"F",gp:48,g:24,a:52,pts:76,pim:24,pm:12,ppg:14,ratio:1.583},
      {n:"David Pastrnak",t:"Boston",nat:"CZ",age:28,pos:"F",gp:52,g:38,a:40,pts:78,pim:20,pm:16,ppg:15,ratio:1.500},
      {n:"Leon Draisaitl",t:"Edmonton",nat:"DE",age:29,pos:"F",gp:50,g:34,a:42,pts:76,pim:38,pm:8,ppg:18,ratio:1.520},
      {n:"Artemi Panarin",t:"NYRangers",nat:"RU",age:33,pos:"F",gp:52,g:22,a:50,pts:72,pim:30,pm:4,ppg:8,ratio:1.385},
      {n:"Auston Matthews",t:"Toronto",nat:"US",age:27,pos:"F",gp:48,g:35,a:32,pts:67,pim:16,pm:8,ppg:16,ratio:1.396},
      {n:"Jack Hughes",t:"NewJersey",nat:"US",age:23,pos:"F",gp:48,g:26,a:38,pts:64,pim:18,pm:6,ppg:9,ratio:1.333},
      {n:"Elias Pettersson",t:"Vancouver",nat:"SE",age:26,pos:"F",gp:50,g:28,a:38,pts:66,pim:22,pm:8,ppg:10,ratio:1.320},
      {n:"Roman Josi",t:"Nashville",nat:"CH",age:34,pos:"D",gp:52,g:14,a:50,pts:64,pim:22,pm:10,ppg:8,ratio:1.231},
      {n:"Connor Hellebuyck",t:"Winnipeg",nat:"US",age:31,pos:"G",gp:42,g:0,a:2,pts:2,pim:2,pm:0,ppg:0,ratio:0.048,svPct:0.924,gaa:2.35},
      {n:"Andrei Vasilevskiy",t:"TampaBay",nat:"RU",age:30,pos:"G",gp:40,g:0,a:1,pts:1,pim:2,pm:0,ppg:0,ratio:0.025,svPct:0.920,gaa:2.52},
    ]
  }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NHL TRICODE MAP  (API tricode MAJUSCULE ‚Üí empire team id)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const NHL_TRICODE_MAP = {
  "BOS":"Boston",   "TOR":"Toronto",    "MTL":"Montreal",  "OTT":"Ottawa",
  "BUF":"Buffalo",  "DET":"Detroit",    "PIT":"Pittsburgh","PHI":"Philadelphia",
  "NJD":"NewJersey","NYI":"NYIslanders","NYR":"NYRangers",  "CAR":"Carolina",
  "WSH":"Washington","COL":"Colorado",  "MIN":"Minnesota", "CHI":"Chicago",
  "STL":"StLouis",  "WPG":"Winnipeg",   "NSH":"Nashville", "DAL":"Dallas",
  "EDM":"Edmonton", "CGY":"Calgary",    "VAN":"Vancouver", "SEA":"Seattle",
  "LAK":"LAKings",  "ANA":"Anaheim",    "SJS":"SanJose",   "UTA":"Utah",
  "VGK":"VegasGolden","FLA":"Florida",  "TBL":"TampaBay",  "CBJ":"Columbus",
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// APP STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let S = {
  league: null,
  view: 'standings',
  players: [],
  teamStats: {},
  schedule: [],
  favTeams: [],
  selectedMatch: null,
  zoneAResult: null,
  zoneBResult: null,
  sortStandings: 'pts',
  aiStatus: {},
  vbType: 'victoire',
  vbDrawerOpen: false,
};

function cfg() { return LEAGUES[S.league]; }
function getTeam(id) { return cfg().teams.find(t=>t.id===id)||{id,name:id,col:'#4dd9f5'}; }
function getSorted(stats,key) {
  return Object.entries(stats).sort((a,b)=>{
    if(key==='pct') return b[1].pct-a[1].pct;
    if(key==='gf') return b[1].gf-a[1].gf;
    if(key==='ga') return a[1].ga-b[1].ga;
    if(key==='ppPct') return b[1].ppPct-a[1].ppPct;
    if(key==='pkPct') return b[1].pkPct-a[1].pkPct;
    return b[1].pts-a[1].pts;
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function normStr(s) {
  if(!s) return '';
  return s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();
}
function matchTeamId(raw) {
  if(!raw) return null;
  const s = normStr(raw);
  const c = cfg();
  if(c.abbrevMap[s]) return c.abbrevMap[s];
  for(const [k,v] of Object.entries(c.abbrevMap)) {
    if(s.includes(k)||k.includes(s)) return v;
  }
  for(const t of c.teams) {
    const tn=normStr(t.name), ti=normStr(t.id);
    if(s.includes(tn)||tn.includes(s)||s.includes(ti)||ti.includes(s)) return t.id;
  }
  return null;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CALCULATORS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function calcGoals(homeId, awayId) {
  const ts = S.teamStats;
  const h = ts[homeId]||{gf:150,ga:150,gp:55,ppPct:20,pkPct:80};
  const a = ts[awayId]||{gf:140,ga:155,gp:55,ppPct:19,pkPct:79};
  const hOff = (h.gf/h.gp)*1.06, aOff = (a.gf/a.gp)*0.94;
  const hDef = h.ga/h.gp, aDef = a.ga/a.gp;
  const ppAdj = ((h.ppPct-a.pkPct)+(a.ppPct-h.pkPct))*0.008;
  const hG = Math.max(1.2,(hOff+aDef)/2+ppAdj*0.5);
  const aG = Math.max(1.0,(aOff+hDef)/2-ppAdj*0.5);
  const tot = hG+aG, diff = hG-aG;
  const hW = Math.min(0.82,Math.max(0.18,0.5+diff*0.12));
  const aW = Math.min(0.75,Math.max(0.12,0.5-diff*0.10));
  const ot = Math.max(0.08,1-hW-aW);
  return {
    homeGoals:Math.round(hG*10)/10, awayGoals:Math.round(aG*10)/10,
    total:Math.round(tot*10)/10,
    homeWin:Math.round(hW*100), awayWin:Math.round(aW*100), otProb:Math.round(ot*100),
    over55:Math.round((tot>5.5?0.62:0.38)*100),
    over45:Math.round((tot>4.5?0.68:0.42)*100),
    btts:Math.round(Math.min(0.88,(hG>1.5&&aG>1.2)?0.74:0.52)*100),
    confidence:tot>5.8?"HAUTE":tot>4.6?"MOYENNE":"BASSE"
  };
}
function isVisionGold(p) {
  if(p.pos==='G') return false;
  return p.gp>0 && (p.a/p.gp)>=0.65 && p.a>=15;
}
function visionProb(p) {
  if(!isVisionGold(p)) return 0;
  const l=p.a/p.gp, p0=Math.exp(-l), p1=l*Math.exp(-l);
  return Math.round((1-p0-p1)*100);
}
function detectFire(homeId, awayId) {
  const h=S.teamStats[homeId], a=S.teamStats[awayId];
  if(!h||!a) return null;
  const hA=h.ppPct-a.pkPct, aA=a.ppPct-h.pkPct;
  const mx=Math.max(hA,aA);
  if(mx<=2.0) return null;
  return {teamId:hA>=aA?homeId:awayId,advantage:mx.toFixed(1),intensity:mx>6?"üî•üî•":"üî•"};
}
function computeStrength(id, isHome) {
  const st=S.teamStats[id];
  if(!st) return {score:50,offense:50,defense:50,pp:50,pk:50};
  const off=Math.min(100,(st.gf/st.gp/3.8)*100);
  const def=Math.min(100,(1-st.ga/st.gp/3.8)*100);
  const pp=Math.min(100,(st.ppPct/25)*100);
  const pk=Math.min(100,(st.pkPct/90)*100);
  const form=(st.form||[]).reduce((s,r,i)=>s+r*(i+1),0)/15*100;
  const loc=isHome?(st.homeW||10)/((st.homeW||10)+(st.homeL||10))*100:(st.awayW||8)/((st.awayW||8)+(st.awayL||12))*100;
  const score=off*.18+def*.18+pp*.12+pk*.12+(st.pct||50)*.15+form*.15+loc*.10;
  return {score:Math.round(score*10)/10,offense:Math.round(off),defense:Math.round(def),pp:Math.round(pp),pk:Math.round(pk)};
}
function kellyCalc(prob,cote) {
  const p=prob/100, b=cote-1;
  return Math.max(0,Math.min((p*cote-1)/b,0.25));
}
function getMise(kelly,conf) {
  const f=conf==="HAUTE"?0.5:conf==="MOYENNE"?0.35:0.2;
  const pct=Math.round(kelly*f*100*10)/10;
  if(pct<=0) return null;
  if(pct<0.5) return {pct,label:"MICRO-MISE",col:"#4dd9f5"};
  if(pct<2) return {pct,label:"PRUDENTE",col:"#f0c84a"};
  if(pct<4) return {pct,label:"CONFIANTE",col:"#00f5a0"};
  return {pct,label:"FORTE",col:"#ff9f00"};
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PARSERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function parseSchedule(raw) {
  if(!raw||!raw.trim()) return [];
  const text=raw.trim();
  if(text.startsWith('[')) {
    try{const a=JSON.parse(text);if(Array.isArray(a)&&a[0]?.home) return a;}catch{}
  }

  // ‚îÄ‚îÄ Parseur HTML Liiga calendar (liiga.fi game week) ‚îÄ‚îÄ
  if(text.includes('game-card-border-') || text.includes('_gameCardContainer_') || text.includes('_borderWrapper_')) {
    try {
      const parser = new DOMParser();
      const doc = parser.parseFromString('<div id="liiga-root">' + text + '</div>', 'text/html');
      const root = doc.getElementById('liiga-root');
      const res = [];
      let currentDate = new Date().toISOString().split('T')[0];

      // Flatten all elements in document order, looking for day headers and game cards
      const allEls = Array.from(root.querySelectorAll('*'));
      const processed = new Set();

      for(const el of allEls) {
        // Day header: div with id containing "day-header"
        if(el.id && el.id.includes('day-header')) {
          const txt = el.textContent.trim();
          const dm = txt.match(/(\d{1,2})\.(\d{1,2})\.(\d{4})/);
          if(dm) {
            currentDate = `${dm[3]}-${dm[2].padStart(2,'0')}-${dm[1].padStart(2,'0')}`;
          } else if(/today/i.test(txt)) {
            currentDate = new Date().toISOString().split('T')[0];
          }
          continue;
        }

        // Game card: div with id "game-card-border-XXX"
        if(el.id && /^game-card-border-/.test(el.id) && !processed.has(el.id)) {
          processed.add(el.id);
          const link = el.querySelector('a[href*="/game/"]');
          if(!link) continue;
          const href = link.getAttribute('href') || '';
          // Date from URL param
          const paivaM = href.match(/[?&]paiva=(\d{8})/);
          let date = currentDate;
          if(paivaM) {
            const p = paivaM[1];
            date = `${p.slice(4)}-${p.slice(2,4)}-${p.slice(0,2)}`;
          }
          // Team names from _teamName_ divs
          const teamDivs = el.querySelectorAll('[class*="_teamName_"]');
          const kotiM = href.match(/[?&]koti=([^&]+)/);
          const vierasM = href.match(/[?&]vieras=([^&]+)/);
          const rawH = teamDivs[0]?.textContent?.trim() || (kotiM ? kotiM[1] : '');
          const rawA = teamDivs[1]?.textContent?.trim() || (vierasM ? vierasM[1] : '');
          // Time
          const timeEl = el.querySelector('[class*="StartTime"]');
          const time = timeEl?.textContent?.trim() || null;
          const home = matchTeamId(rawH);
          const away = matchTeamId(rawA);
          if(!home || !away || home === away) continue;
          res.push({ home, away, date, time, status:'upcoming', hs:null, as:null });
        }
      }
      if(res.length > 0) return res;
    } catch(e) { console.warn('Liiga calendar HTML parse error', e); }
  }

  const res=[];
  for(const line of text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l.length>2)) {
    if(/^(date|#|round)/i.test(line)||/^[-=_]{3,}/.test(line)) continue;
    if(!/\bvs\.?|contre|@|\s-\s/i.test(line)&&!/ - /.test(line)) continue;
    const m=parseMatchLine(line);
    if(m) res.push(m);
  }
  return res;
}
function parseMatchLine(line) {
  const l=line.replace(/\|/g,' ').replace(/\s+/g,' ').trim();
  let date=null,time=null;
  const dm=l.match(/(\d{4}-\d{2}-\d{2})|(\d{1,2}[\/\-\.]\d{1,2}(?:[\/\-\.]\d{2,4})?)/);
  if(dm) {
    const ds=dm[0];
    if(ds.includes('-')&&ds.length===10){date=ds;}
    else{
      const p=ds.split(/[\/\-\.]/);
      const d=p[0].padStart(2,'0'),mo=p[1].padStart(2,'0');
      const yr=p[2]?(p[2].length===2?'20'+p[2]:p[2]):'2026';
      date=`${yr}-${mo}-${d}`;
    }
  } else date=new Date().toISOString().split('T')[0];
  const tm=l.match(/\b(\d{1,2}):(\d{2})\b/);
  if(tm) time=tm[0];
  const sep=/\bvs\.?\s|\bcontre\s|\s@\s|\s-\s/i;
  const parts=l.split(sep);
  if(parts.length<2) return null;
  let rawH=parts[0].replace(/\d{4}-\d{2}-\d{2}|\d{1,2}[\/\-\.]\d{1,2}(?:[\/\-\.]\d{2,4})?|\d{1,2}:\d{2}/g,'').trim();
  let rawA=parts[1].replace(/\d{4}-\d{2}-\d{2}|\d{1,2}[\/\-\.]\d{1,2}(?:[\/\-\.]\d{2,4})?|\d{1,2}:\d{2}/g,'').trim();
  rawH=rawH.replace(/^[\s\-\|]+|[\s\-\|]+$/g,'');
  rawA=rawA.replace(/^[\s\-\|]+|[\s\-\|]+$/g,'');
  const home=matchTeamId(rawH), away=matchTeamId(rawA);
  if(!home||!away||home===away) return null;
  return {home,away,date,time,status:'upcoming',hs:null,as:null};
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HTML BUILDERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function formDots(form) {
  return (form||[]).map(r=>`<span style="display:inline-block;width:8px;height:8px;border-radius:50%;background:${r?'#00f5a0':'#ff4466'};box-shadow:0 0 4px ${r?'#00f5a0':'#ff4466'}"></span>`).join('');
}
function posTag(pos) {
  const c=pos==='G'?'#f0c84a':pos==='D'?'#4dd9f5':'#00f5a0';
  return `<span class="pos-tag" style="background:${c}22;color:${c};border:1px solid ${c}44">${pos}</span>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VIEWS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderStandings() {
  const sorted=getSorted(S.teamStats,S.sortStandings);
  const ac=cfg().accent;
  const thStyle=(key)=>S.sortStandings===key
    ?`style="padding:8px 10px;font-size:10px;letter-spacing:2px;color:${ac};cursor:pointer;font-weight:700;text-decoration:underline;white-space:nowrap"`
    :`style="padding:8px 10px;font-size:10px;letter-spacing:2px;color:${ac}66;cursor:pointer;font-weight:700;white-space:nowrap"`;
  let rows='';
  sorted.forEach(([id,st],idx)=>{
    const team=getTeam(id);
    const formH=formDots(st.form);
    rows+=`<tr class="hrow" style="border-bottom:1px solid rgba(77,217,245,.05);background:${idx%2===0?'rgba(255,255,255,.01)':'transparent'}">
      <td style="padding:10px;text-align:center;font-family:'Cinzel',serif;font-size:14px;color:${idx<3?'#f0c84a':'rgba(168,240,255,.4)'};font-weight:${idx<3?700:400}">${idx+1}</td>
      <td style="padding:10px 12px">
        <div style="display:flex;align-items:center;gap:10px">
          <div style="width:4px;height:28px;background:${team.col};border-radius:2px;flex-shrink:0;box-shadow:0 0 6px ${team.col}88"></div>
          <div>
            <div style="font-family:'Cinzel',serif;font-size:13px;font-weight:700;color:${team.col||'#a8f0ff'}">${team.name}</div>
            <div style="font-size:10px;color:rgba(168,240,255,.35);letter-spacing:1px">${team.city}</div>
          </div>
        </div>
      </td>
      <td style="padding:10px;text-align:center;font-size:13px;color:#00f5a0;font-weight:700">${st.w}</td>
      <td style="padding:10px;text-align:center;font-size:13px;color:#ff4466">${st.l}</td>
      <td style="padding:10px;text-align:center;font-size:13px;color:rgba(168,240,255,.5)">${st.otl}</td>
      <td style="padding:10px;text-align:center;font-family:'Cinzel',serif;font-size:17px;font-weight:700;color:#f0c84a;text-shadow:0 0 10px rgba(240,200,74,.4)">${st.pts}</td>
      <td style="padding:10px;text-align:center;font-size:12px;color:rgba(168,240,255,.5)">${st.gp}</td>
      <td style="padding:10px;text-align:center;font-size:12px;color:rgba(77,217,245,.8)">${st.gf}</td>
      <td style="padding:10px;text-align:center;font-size:12px;color:rgba(255,68,102,.7)">${st.ga}</td>
      <td style="padding:10px;text-align:center;font-size:11px;color:${st.ppPct>=22?'#f0c84a':st.ppPct>=18?'#4dd9f5':'rgba(168,240,255,.5)'}">${st.ppPct}%</td>
      <td style="padding:10px;text-align:center;font-size:11px;color:${st.pkPct>=84?'#00f5a0':st.pkPct>=80?'#4dd9f5':'rgba(168,240,255,.5)'}">${st.pkPct}%</td>
      <td style="padding:10px"><div style="display:flex;gap:3px">${formH}</div></td>
    </tr>`;
  });
  return `<div class="tab-content" style="overflow-x:auto;background:rgba(6,20,40,.7);border-radius:12px;border:1px solid rgba(77,217,245,.12)">
    <table class="data-table">
      <thead><tr style="background:rgba(2,11,24,.85);border-bottom:1px solid rgba(77,217,245,.15)">
        <th ${thStyle('')} onclick="setSortBy('pts')">POS</th>
        <th ${thStyle('')} onclick="setSortBy('pts')">√âQUIPE</th>
        <th ${thStyle('pts')} onclick="setSortBy('pts')">V</th>
        <th ${thStyle('')} onclick="setSortBy('pts')">D</th>
        <th ${thStyle('')} onclick="setSortBy('pts')">OTL</th>
        <th ${thStyle('pts')} onclick="setSortBy('pts')">PTS</th>
        <th ${thStyle('')} onclick="">MJ</th>
        <th ${thStyle('gf')} onclick="setSortBy('gf')">GF</th>
        <th ${thStyle('ga')} onclick="setSortBy('ga')">GA</th>
        <th ${thStyle('ppPct')} onclick="setSortBy('ppPct')">PP%</th>
        <th ${thStyle('pkPct')} onclick="setSortBy('pkPct')">PK%</th>
        <th ${thStyle('')}>FORME</th>
      </tr></thead>
      <tbody>${rows}</tbody>
    </table>
  </div>`;
}

// Normalise "YYYY-M-D" ou "YYYY-MM-DD" en "YYYY-MM-DD" fiable
function normalizeDate(d) {
  if(!d) return '';
  const s = String(d).trim();
  // D√©j√† au format YYYY-MM-DD
  if(/^\d{4}-\d{2}-\d{2}$/.test(s)) return s;
  // Format YYYY-M-D ou YYYY-MM-D etc.
  const parts = s.split('-');
  if(parts.length === 3 && parts[0].length === 4) {
    return parts[0] + '-' + parts[1].padStart(2,'0') + '-' + parts[2].padStart(2,'0');
  }
  return s;
}

function renderSchedule() {
  const upcoming=S.schedule.filter(m=>m.status==='upcoming').sort((a,b)=>normalizeDate(a.date).localeCompare(normalizeDate(b.date)));
  const byDate={};
  for(const m of upcoming) { const nd=normalizeDate(m.date); if(!byDate[nd]) byDate[nd]=[]; byDate[nd].push(m); }
  const skaters=S.players.filter(p=>p.pos!=='G');
  const topB=[...skaters].sort((a,b)=>b.g-a.g).slice(0,10);
  const topA=[...skaters].sort((a,b)=>b.a-a.a).slice(0,10);
  const sorted=Object.entries(byDate).sort(([a],[b])=>a.localeCompare(b));
  let matchHtml='';

  // ‚úÖ FIX 1 ‚Äî Bouton retour en haut du calendrier
  matchHtml+=`<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:10px">
    <button onclick="setView('standings')" style="padding:7px 16px;border:1px solid rgba(77,217,245,.3);border-radius:6px;background:transparent;color:rgba(77,217,245,.6);cursor:pointer;font-size:11px;letter-spacing:2px;font-family:'Rajdhani',sans-serif;font-weight:700;transition:all .2s" onmouseover="this.style.borderColor='rgba(77,217,245,.7)';this.style.color='#4dd9f5'" onmouseout="this.style.borderColor='rgba(77,217,245,.3)';this.style.color='rgba(77,217,245,.6)'">‚Üê CLASSEMENT</button>
    <div style="font-family:'Cinzel',serif;font-size:10px;letter-spacing:4px;color:${cfg().accent}66">${upcoming.length} MATCH${upcoming.length!==1?'S':''} √Ä VENIR</div>
  </div>`;

  if(sorted.length===0) {
    matchHtml+=`<div style="text-align:center;padding:60px 20px;color:rgba(168,240,255,.3)">
      <div style="font-size:36px;margin-bottom:12px">üìÖ</div>
      <div style="font-family:'Cinzel',serif;font-size:14px;letter-spacing:4px">AUCUN MATCH PROGRAMM√â</div>
      <div style="font-size:11px;margin-top:8px;letter-spacing:2px">Utilise ‚ö° SYNC pour ajouter des matchs (Zone B)</div>
    </div>`;
  } else {
    for(const [date,matches] of sorted) {
      const nd=normalizeDate(date);
      const dt=nd?new Date(nd+'T12:00:00'):null;
      const dayLabel=(dt&&!isNaN(dt))?dt.toLocaleDateString('fr-FR',{weekday:'long',day:'numeric',month:'long'}):nd||date||'';
      matchHtml+=`<div style="margin-bottom:24px">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
          <div style="height:1px;flex:1;background:linear-gradient(90deg,rgba(77,217,245,.2),transparent)"></div>
          <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:${cfg().accent}88;white-space:nowrap">${dayLabel.toUpperCase()}</div>
          <div style="height:1px;flex:1;background:linear-gradient(90deg,transparent,rgba(77,217,245,.2))"></div>
        </div>
        <div style="display:flex;flex-direction:column;gap:10px">`;
      for(const m of matches) {
        const ht=getTeam(m.home), at=getTeam(m.away);
        const goals=calcGoals(m.home,m.away);
        const fire=detectFire(m.home,m.away);
        const fireH=fire?`<span class="fire-badge" style="padding:2px 8px;border-radius:5px;font-size:10px;font-weight:700;background:rgba(255,107,0,.12);border:1px solid rgba(255,107,0,.4);color:#ff6b00">${fire.intensity} +${fire.advantage}%</span>`:'';
        const goalsH=`<span class="goals-badge">‚öΩ ~${goals.homeGoals}‚Äì${goals.awayGoals}</span>`;
        const time=m.time||'';
        matchHtml+=`<div onclick="openMatch(${JSON.stringify(m).replace(/"/g,'&quot;')})" style="padding:16px 20px;background:rgba(6,20,40,.75);border:1px solid rgba(77,217,245,.1);border-radius:12px;cursor:pointer;transition:border-color .2s,box-shadow .2s" onmouseover="this.style.borderColor='${cfg().accent}55';this.style.boxShadow='0 4px 20px rgba(0,0,0,.3)'" onmouseout="this.style.borderColor='rgba(77,217,245,.1)';this.style.boxShadow='none'">
          <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
            <div style="display:flex;align-items:center;gap:10px">
              <div style="width:3px;height:36px;background:${ht.col};border-radius:2px;box-shadow:0 0 6px ${ht.col}88"></div>
              <div>
                <div style="font-family:'Cinzel',serif;font-size:15px;font-weight:900;color:${ht.col}">${ht.name}</div>
                <div style="font-size:10px;color:rgba(168,240,255,.4);letter-spacing:1px">${ht.city}</div>
              </div>
            </div>
            <div style="text-align:center">
              <div style="font-family:'Cinzel',serif;font-size:13px;font-weight:700;letter-spacing:4px;color:rgba(168,240,255,.5)">VS</div>
              ${time?`<div style="font-size:10px;color:${cfg().accent};letter-spacing:2px">${time}</div>`:''}
              <div style="display:flex;gap:6px;justify-content:center;margin-top:6px;flex-wrap:wrap">${goalsH}${fireH}</div>
            </div>
            <div style="display:flex;align-items:center;gap:10px">
              <div style="text-align:right">
                <div style="font-family:'Cinzel',serif;font-size:15px;font-weight:900;color:${at.col}">${at.name}</div>
                <div style="font-size:10px;color:rgba(168,240,255,.4);letter-spacing:1px">${at.city}</div>
              </div>
              <div style="width:3px;height:36px;background:${at.col};border-radius:2px;box-shadow:0 0 6px ${at.col}88"></div>
            </div>
          </div>
        </div>`;
      }
      matchHtml+='</div></div>';
    }
  }
  // Top scorers sidebars
  const makeTopRow=(p,i,val,col)=>{
    const t=getTeam(p.t);
    return `<div class="hrow" style="padding:7px 14px;border-bottom:1px solid rgba(77,217,245,.04);display:flex;align-items:center;gap:10px">
      <div style="font-family:'Cinzel',serif;font-size:12px;font-weight:700;color:${i<3?'#f0c84a':'rgba(168,240,255,.25)'};min-width:22px;text-align:center">${i+1}</div>
      <div style="width:3px;height:30px;background:${t.col};border-radius:2px;flex-shrink:0"></div>
      <div style="flex:1;min-width:0">
        <div style="font-size:12px;font-weight:700;color:#d4f8ff">${p.n}${isVisionGold(p)?'<span style="font-size:8px;color:#f0c84a;margin-left:4px">ü•á</span>':''}</div>
        <div style="font-size:10px;color:${t.col};font-weight:700;letter-spacing:1px">${p.t} ${posTag(p.pos)}</div>
      </div>
      <div style="font-family:'Cinzel',serif;font-size:22px;font-weight:900;color:${col};min-width:36px;text-align:right">${val}</div>
    </div>`;
  };
  const topBH=topB.map((p,i)=>makeTopRow(p,i,p.g,'#00f5a0')).join('');
  const topAH=topA.map((p,i)=>makeTopRow(p,i,p.a,'#4dd9f5')).join('');
  return `<div class="tab-content" style="display:grid;grid-template-columns:1fr 320px;gap:24px">
    <div>${matchHtml}</div>
    <div style="display:flex;flex-direction:column;gap:16px">
      <div class="top-card">
        <div class="top-card-hdr"><span style="font-family:'Cinzel',serif;font-size:12px;font-weight:700;letter-spacing:3px;color:#00f5a0">ü•Ö TOP BUTEURS</span></div>
        ${topBH}
      </div>
      <div class="top-card">
        <div class="top-card-hdr"><span style="font-family:'Cinzel',serif;font-size:12px;font-weight:700;letter-spacing:3px;color:#4dd9f5">üéØ TOP PASSEURS</span></div>
        ${topAH}
      </div>
    </div>
  </div>`;
}

function renderPlayers() {
  const skaters=S.players.filter(p=>p.pos!=='G');
  const topB=[...skaters].sort((a,b)=>b.g-a.g).slice(0,15);
  const topA=[...skaters].sort((a,b)=>b.a-a.a).slice(0,15);
  const topP=[...skaters].sort((a,b)=>b.pts-a.pts).slice(0,15);
  const vision=[...skaters].filter(isVisionGold).sort((a,b)=>visionProb(b)-visionProb(a)).slice(0,10);

  const makeSpotRow=(p,i,val,col,key)=>{
    const t=getTeam(p.t), g=isVisionGold(p);
    const mx=key==='g'?(topB[0]?.g||1):key==='a'?(topA[0]?.a||1):(topP[0]?.pts||1);
    const bPct=Math.min(100,(val/mx)*100);
    return `<div class="hrow" style="padding:7px 14px;border-bottom:1px solid rgba(77,217,245,.04);display:flex;align-items:center;gap:10px">
      <div style="font-family:'Cinzel',serif;font-size:13px;font-weight:700;color:${i<3?'#f0c84a':'rgba(168,240,255,.25)'};min-width:22px;text-align:center">${i+1}</div>
      <div style="width:3px;height:32px;background:${t.col};border-radius:2px;flex-shrink:0"></div>
      <div style="flex:1;min-width:0">
        <div style="font-size:12px;font-weight:700;color:#d4f8ff">${p.n}${g?'<span style="font-size:8px;color:#f0c84a;margin-left:4px">ü•á</span>':''}</div>
        <div style="display:flex;gap:5px;align-items:center;margin-top:2px"><span style="font-size:10px;color:${t.col};font-weight:700">${p.t}</span>${posTag(p.pos)}</div>
        <div style="height:3px;background:rgba(255,255,255,.05);border-radius:2px;margin-top:4px;overflow:hidden"><div style="width:${bPct}%;height:100%;border-radius:2px;background:linear-gradient(90deg,#4dd9f5,#e1adff)"></div></div>
      </div>
      <div style="text-align:center;min-width:44px">
        <div style="font-family:'Cinzel',serif;font-size:22px;font-weight:900;color:${col};line-height:1">${val}</div>
        <div style="font-size:8px;color:rgba(168,240,255,.3);letter-spacing:1px">${key.toUpperCase()}</div>
      </div>
    </div>`;
  };
  const makePointsRow=(p,i)=>{
    const t=getTeam(p.t);
    return `<div class="hrow" style="display:grid;grid-template-columns:22px 3px 1fr 36px 30px 30px 46px;gap:8px;padding:7px 14px;align-items:center;border-bottom:1px solid rgba(77,217,245,.04)">
      <div style="font-family:'Cinzel',serif;font-size:12px;color:${i<3?'#f0c84a':'rgba(168,240,255,.25)'};font-weight:${i<3?700:400};text-align:center">${i+1}</div>
      <div style="width:3px;height:28px;background:${t.col};border-radius:2px"></div>
      <div><div style="font-size:12px;font-weight:700;color:#d4f8ff">${p.n}${isVisionGold(p)?'<span style="font-size:8px;color:#f0c84a;margin-left:4px">ü•á</span>':''}</div><div style="font-size:9px;color:${t.col};letter-spacing:1px;font-weight:700">${p.t}</div></div>
      <div style="font-family:'Cinzel',serif;font-size:16px;font-weight:900;color:#f0c84a;text-align:center">${p.pts}</div>
      <div style="font-size:11px;color:#00f5a0;text-align:center;font-weight:700">${p.g}</div>
      <div style="font-size:11px;color:#4dd9f5;text-align:center;font-weight:700">${p.a}</div>
      <div style="font-size:9px;color:${p.ratio>=1?'#00f5a0':p.ratio>=0.75?'#f0c84a':'rgba(168,240,255,.4)'};text-align:center;font-weight:700">${p.ratio.toFixed(3)}</div>
    </div>`;
  };
  const visionRows=vision.map((p,i)=>{
    const prob=visionProb(p), t=getTeam(p.t);
    return `<div class="hrow" style="padding:9px 14px;border-bottom:1px solid rgba(77,217,245,.04);display:flex;align-items:center;gap:10px">
      <div style="font-family:'Cinzel',serif;font-size:13px;color:${i<3?'#f0c84a':'rgba(168,240,255,.3)'};min-width:22px;text-align:center;font-weight:${i<3?700:400}">${i+1}</div>
      <div style="flex:1"><div style="font-size:12px;font-weight:700;color:#d4f8ff">${p.n}</div><div style="font-size:10px;color:${t.col};letter-spacing:1px;font-weight:700">${p.t} ¬∑ ${p.a}A/${p.gp}MJ</div></div>
      <span class="vision-badge">${prob}%</span>
    </div>`;
  }).join('');
  const allPlayers=[...S.players].sort((a,b)=>b.pts-a.pts);
  const tableRows=allPlayers.map(p=>{
    const t=getTeam(p.t), g=isVisionGold(p);
    return `<tr class="hrow" style="border-bottom:1px solid rgba(77,217,245,.05)">
      <td style="padding:8px 12px">
        <div style="font-size:12px;font-weight:700;color:#d4f8ff">${p.n}${g?'<span style="font-size:8px;color:#f0c84a;margin-left:4px">ü•á</span>':''}</div>
      </td>
      <td style="padding:8px;font-size:11px;color:${t.col};font-weight:700">${p.t}</td>
      <td style="padding:8px;text-align:center">${posTag(p.pos)}</td>
      <td style="padding:8px;text-align:center;font-family:'Cinzel',serif;font-size:16px;font-weight:700;color:#f0c84a">${p.pts}</td>
      <td style="padding:8px;text-align:center;font-size:12px;color:#00f5a0;font-weight:700">${p.g}</td>
      <td style="padding:8px;text-align:center;font-size:12px;color:#4dd9f5;font-weight:700">${p.a}</td>
      <td style="padding:8px;text-align:center;font-size:11px;color:rgba(168,240,255,.5)">${p.gp}</td>
      <td style="padding:8px;text-align:center;font-size:11px;color:${p.ratio>=1?'#00f5a0':p.ratio>=0.75?'#f0c84a':'rgba(168,240,255,.4)'};font-weight:700">${p.ratio.toFixed(3)}</td>
      ${p.svPct?`<td style="padding:8px;text-align:center;font-size:11px;color:#c084fc">${p.svPct.toFixed(3)}</td>`:'<td></td>'}
    </tr>`;
  }).join('');
  return `<div class="tab-content">
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px">
      <div class="top-card"><div class="top-card-hdr"><span style="font-family:'Cinzel',serif;font-size:12px;font-weight:700;letter-spacing:3px;color:#00f5a0">ü•Ö TOP BUTEURS</span></div>${topB.map((p,i)=>makeSpotRow(p,i,p.g,'#00f5a0','g')).join('')}</div>
      <div class="top-card"><div class="top-card-hdr"><span style="font-family:'Cinzel',serif;font-size:12px;font-weight:700;letter-spacing:3px;color:#4dd9f5">üéØ TOP PASSEURS</span></div>${topA.map((p,i)=>makeSpotRow(p,i,p.a,'#4dd9f5','a')).join('')}</div>
    </div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px">
      <div class="top-card"><div class="top-card-hdr"><span style="font-family:'Cinzel',serif;font-size:12px;font-weight:700;letter-spacing:3px;color:#f0c84a">‚≠ê TOP POINTEURS</span></div>${topP.map((p,i)=>makePointsRow(p,i)).join('')}</div>
      <div class="top-card"><div class="top-card-hdr" style="display:flex;align-items:center;justify-content:space-between"><span style="font-family:'Cinzel',serif;font-size:12px;font-weight:700;letter-spacing:3px;color:#f0c84a">ü•á VISION GOLD</span><span style="font-size:9px;color:rgba(168,240,255,.35)">ratio A/MJ ‚â• 0.65</span></div>${vision.length===0?'<div style="padding:30px;text-align:center;color:rgba(168,240,255,.3)">Aucun joueur Vision Gold</div>':visionRows}</div>
    </div>
    <div style="margin-bottom:8px;display:flex;align-items:center;gap:8px">
      <div style="font-family:'Cinzel',serif;font-size:10px;letter-spacing:4px;color:${cfg().accent}55">‚ú¶ TABLEAU COMPLET</div>
      <div style="flex:1;height:1px;background:linear-gradient(90deg,${cfg().accent}33,transparent)"></div>
    </div>
    <div style="overflow-x:auto;background:rgba(6,20,40,.7);border-radius:12px;border:1px solid rgba(77,217,245,.12)">
      <table class="data-table">
        <thead><tr style="background:rgba(2,11,24,.85);border-bottom:1px solid rgba(77,217,245,.15)">
          <th style="padding:8px 12px;font-size:10px;letter-spacing:2px;color:rgba(77,217,245,.5);font-weight:700;text-align:left">JOUEUR</th>
          <th style="padding:8px;font-size:10px;letter-spacing:2px;color:rgba(77,217,245,.5);font-weight:700">√âQUIPE</th>
          <th style="padding:8px;font-size:10px;letter-spacing:2px;color:rgba(77,217,245,.5);font-weight:700">POS</th>
          <th style="padding:8px;font-size:10px;letter-spacing:2px;color:#f0c84a;font-weight:700">PTS</th>
          <th style="padding:8px;font-size:10px;letter-spacing:2px;color:#00f5a0;font-weight:700">B</th>
          <th style="padding:8px;font-size:10px;letter-spacing:2px;color:#4dd9f5;font-weight:700">A</th>
          <th style="padding:8px;font-size:10px;letter-spacing:2px;color:rgba(77,217,245,.5);font-weight:700">MJ</th>
          <th style="padding:8px;font-size:10px;letter-spacing:2px;color:rgba(77,217,245,.5);font-weight:700">RATIO</th>
          <th style="padding:8px;font-size:10px;letter-spacing:2px;color:rgba(192,132,252,.5);font-weight:700">SV%</th>
        </tr></thead>
        <tbody>${tableRows}</tbody>
      </table>
    </div>
  </div>`;
}

function renderMatch(m) {
  const ht=getTeam(m.home), at=getTeam(m.away);
  const goals=calcGoals(m.home,m.away);
  const fire=detectFire(m.home,m.away);
  const hStr=computeStrength(m.home,true), aStr=computeStrength(m.away,false);
  const hSt=S.teamStats[m.home]||{}, aSt=S.teamStats[m.away]||{};
  const hPlayers=S.players.filter(p=>p.t===m.home&&p.pos!=='G').sort((a,b)=>b.pts-a.pts).slice(0,6);
  const aPlayers=S.players.filter(p=>p.t===m.away&&p.pos!=='G').sort((a,b)=>b.pts-a.pts).slice(0,6);
  const hVision=S.players.filter(p=>p.t===m.home&&isVisionGold(p));
  const aVision=S.players.filter(p=>p.t===m.away&&isVisionGold(p));

  const makeBar=(lbl,hv,av)=>`
    <div style="display:grid;grid-template-columns:60px 1fr 60px;gap:10px;align-items:center;margin-bottom:10px">
      <div style="font-family:'Cinzel',serif;font-size:13px;font-weight:700;color:${ht.col};text-align:right">${Math.round(hv)}%</div>
      <div style="position:relative;height:6px;background:rgba(255,255,255,.05);border-radius:3px;overflow:hidden">
        <div class="strength-bar" style="position:absolute;left:0;top:0;width:${hv}%;background:${ht.col};border-radius:3px"></div>
      </div>
      <div style="font-family:'Cinzel',serif;font-size:13px;font-weight:700;color:${at.col}">${Math.round(av)}%</div>
    </div>`;

  const calcRowH=`<div class="calc-grid">
    ${[
      {lbl:'DOM WIN',val:goals.homeWin+'%',col:'#f0c84a'},
      {lbl:'EXT WIN',val:goals.awayWin+'%',col:'#ff4466'},
      {lbl:'TOTAL',val:goals.total+' buts',col:'#ff9f00'},
      {lbl:'OVER 5.5',val:goals.over55+'%',col:'#4dd9f5'},
      {lbl:'OVER 4.5',val:goals.over45+'%',col:'#00f5a0'},
      {lbl:'BTTS',val:goals.btts+'%',col:'#c084fc'},
      {lbl:'DOM BUTS',val:goals.homeGoals,col:ht.col},
      {lbl:'EXT BUTS',val:goals.awayGoals,col:at.col},
      {lbl:'PROLONGATION',val:goals.otProb+'%',col:'rgba(168,240,255,.5)'},
    ].map(c=>`<div class="calc-cell"><div style="font-family:'Cinzel',serif;font-size:20px;font-weight:700;color:${c.col};line-height:1">${c.val}</div><div style="font-size:8px;color:rgba(168,240,255,.3);letter-spacing:1px;margin-top:4px">${c.lbl}</div></div>`).join('')}
  </div>`;

  const makePlayerGrid=(players)=>players.map(p=>{
    return `<div style="padding:8px 10px;background:rgba(6,20,40,.5);border:1px solid rgba(77,217,245,.07);border-radius:8px">
      <div style="font-size:11px;font-weight:700;color:#d4f8ff;margin-bottom:2px">${p.n}${isVisionGold(p)?'<span style="font-size:8px;color:#f0c84a"> ü•á</span>':''}</div>
      <div style="display:flex;gap:8px;align-items:center">
        ${posTag(p.pos)}
        <span style="font-size:11px;color:#f0c84a;font-weight:700">${p.pts}pts</span>
        <span style="font-size:10px;color:#00f5a0">${p.g}B</span>
        <span style="font-size:10px;color:#4dd9f5">${p.a}A</span>
      </div>
    </div>`;
  }).join('');

  return `<div class="tab-content">
    <button onclick="setView('schedule')" style="margin-bottom:20px;padding:6px 14px;border:1px solid rgba(77,217,245,.3);border-radius:6px;background:transparent;color:rgba(77,217,245,.6);cursor:pointer;font-size:11px;letter-spacing:2px">‚Üê RETOUR</button>
    ${fire?`<div class="fire-badge" style="padding:12px 20px;background:rgba(255,107,0,.08);border:1px solid rgba(255,107,0,.3);border-radius:10px;text-align:center;margin-bottom:16px;font-family:'Cinzel',serif;font-size:13px;font-weight:700;color:#ff6b00;letter-spacing:2px">${fire.intensity} MATCH DE FEU ‚Äî Avantage ${getTeam(fire.teamId).name} +${fire.advantage}% PP/PK</div>`:''}
    <div style="display:grid;grid-template-columns:1fr auto 1fr;gap:20px;align-items:center;margin-bottom:24px;padding:24px;background:rgba(6,20,40,.75);border:1px solid rgba(77,217,245,.12);border-radius:14px">
      <div style="text-align:center">
        <div style="width:5px;height:48px;background:${ht.col};border-radius:3px;margin:0 auto 10px;box-shadow:0 0 12px ${ht.col}88"></div>
        <div style="font-family:'Cinzel',serif;font-size:24px;font-weight:900;color:${ht.col}">${ht.name}</div>
        <div style="font-size:10px;color:rgba(168,240,255,.4);letter-spacing:2px;margin-top:4px">${ht.city}</div>
        <div style="font-size:11px;color:rgba(168,240,255,.5);margin-top:6px">${hSt.w||0}V-${hSt.l||0}D ¬∑ ${hSt.pts||0}pts</div>
        <div style="font-family:'Cinzel',serif;font-size:28px;font-weight:900;color:#4dd9f5;margin-top:8px">${hStr.score}<span style="font-size:12px;color:rgba(77,217,245,.5)">/100</span></div>
      </div>
      <div style="text-align:center">
        <div style="font-family:'Cinzel',serif;font-size:16px;font-weight:700;letter-spacing:6px;color:rgba(168,240,255,.3)">VS</div>
        ${m.date?`<div style="font-size:11px;color:rgba(168,240,255,.4);letter-spacing:1px;margin-top:4px">${m.date}</div>`:''}
        ${m.time?`<div style="font-family:'Cinzel',serif;font-size:16px;color:${cfg().accent};letter-spacing:2px;margin-top:6px">${m.time}</div>`:''}
      </div>
      <div style="text-align:center">
        <div style="width:5px;height:48px;background:${at.col};border-radius:3px;margin:0 auto 10px;box-shadow:0 0 12px ${at.col}88"></div>
        <div style="font-family:'Cinzel',serif;font-size:24px;font-weight:900;color:${at.col}">${at.name}</div>
        <div style="font-size:10px;color:rgba(168,240,255,.4);letter-spacing:2px;margin-top:4px">${at.city}</div>
        <div style="font-size:11px;color:rgba(168,240,255,.5);margin-top:6px">${aSt.w||0}V-${aSt.l||0}D ¬∑ ${aSt.pts||0}pts</div>
        <div style="font-family:'Cinzel',serif;font-size:28px;font-weight:900;color:#4dd9f5;margin-top:8px">${aStr.score}<span style="font-size:12px;color:rgba(77,217,245,.5)">/100</span></div>
      </div>
    </div>
    <div style="padding:20px;background:rgba(6,20,40,.6);border:1px solid rgba(77,217,245,.1);border-radius:12px;margin-bottom:16px">
      <div style="font-family:'Cinzel',serif;font-size:10px;letter-spacing:4px;color:rgba(77,217,245,.5);margin-bottom:14px;text-align:center">COMPARAISON DE FORCE</div>
      ${makeBar('ATTAQUE',hStr.offense,aStr.offense)}
      ${makeBar('D√âFENSE',hStr.defense,aStr.defense)}
      ${makeBar('POWER PLAY',hStr.pp,aStr.pp)}
      ${makeBar('PENALTY KILL',hStr.pk,aStr.pk)}
    </div>
    <div style="padding:20px;background:rgba(6,20,40,.6);border:1px solid rgba(0,245,160,.15);border-radius:12px;margin-bottom:16px">
      <div style="font-family:'Cinzel',serif;font-size:10px;letter-spacing:4px;color:#00f5a0;margin-bottom:16px;text-align:center">‚öΩ CALCULATEUR DE BUTS ‚Äî CONFIANCE: ${goals.confidence}</div>
      ${calcRowH}
    </div>
    <div id="match-vb-section">
      <button onclick="toggleMatchVB()" style="width:100%;padding:12px 18px;display:flex;align-items:center;justify-content:space-between;background:rgba(6,20,40,.75);border:1px solid rgba(77,217,245,.15);border-radius:12px;cursor:pointer;color:#f0c84a;font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;margin-bottom:2px" id="match-vb-toggle">
        <span>üí∞ CALCULATEUR VALUE BET</span><span id="match-vb-arrow" style="font-size:16px;transition:transform .3s">‚ñæ</span>
      </button>
      <div id="match-vb-body" style="display:none;padding:16px;background:rgba(4,14,28,.9);border:1px solid rgba(77,217,245,.12);border-top:none;border-radius:0 0 12px 12px;margin-bottom:16px">
        ${renderMatchVBRows(goals,ht,at)}
      </div>
    </div>
    ${(hVision.length>0||aVision.length>0)?`
    <div style="padding:16px 20px;background:rgba(240,200,74,.04);border:1px solid rgba(240,200,74,.15);border-radius:12px;margin-bottom:16px">
      <div style="font-family:'Cinzel',serif;font-size:10px;letter-spacing:4px;color:#f0c84a;margin-bottom:12px">ü•á VISION GOLD CE MATCH</div>
      <div style="display:flex;flex-wrap:wrap;gap:10px">
        ${[...hVision,...aVision].map(p=>`<div style="display:flex;align-items:center;gap:8px;padding:6px 12px;background:rgba(240,200,74,.06);border:1px solid rgba(240,200,74,.2);border-radius:8px">
          <span style="font-size:11px;color:${getTeam(p.t).col};font-weight:700">${p.n}</span>
          <span class="vision-badge">${visionProb(p)}%</span>
        </div>`).join('')}
      </div>
    </div>`:''}
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px">
      <div style="padding:16px;background:rgba(6,20,40,.65);border:1px solid rgba(77,217,245,.1);border-radius:12px;border-left:3px solid ${ht.col}">
        <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:${ht.col};margin-bottom:12px">‚ú¶ ${ht.name.toUpperCase()}</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px">${makePlayerGrid(hPlayers)}</div>
      </div>
      <div style="padding:16px;background:rgba(6,20,40,.65);border:1px solid rgba(77,217,245,.1);border-radius:12px;border-right:3px solid ${at.col}">
        <div style="font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;color:${at.col};margin-bottom:12px">‚ú¶ ${at.name.toUpperCase()}</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px">${makePlayerGrid(aPlayers)}</div>
      </div>
    </div>

  </div>`;
}

function renderMatchVBRows(goals, ht, at) {
  const scenarios=[
    {key:'homeWin',label:`üèÜ Victoire ${ht.name}`,prob:goals.homeWin},
    {key:'awayWin',label:`üèÜ Victoire ${at.name}`,prob:goals.awayWin},
    {key:'over55',label:'‚¨Ü OVER 5.5 buts',prob:goals.over55},
    {key:'over45',label:'‚¨Ü OVER 4.5 buts',prob:goals.over45},
    {key:'btts',label:'‚öΩ BTTS',prob:goals.btts},
  ];
  return scenarios.map((s,i)=>`
    <div style="padding:12px 14px;background:rgba(6,20,40,.6);border:1px solid rgba(77,217,245,.08);border-radius:10px;margin-bottom:8px" id="mvb-row-${i}">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
        <div style="flex:1;font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:2px;color:rgba(168,240,255,.6)">${s.label}</div>
        <div style="font-size:12px;font-weight:700;color:rgba(168,240,255,.5)">Prob: ${s.prob}%</div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;align-items:center">
        <div>
          <div style="font-size:8px;letter-spacing:2px;color:rgba(77,217,245,.5);margin-bottom:4px;font-weight:700">COTE BOOK.</div>
          <input type="number" class="vb-input" step="0.05" min="1.01" placeholder="ex: 2.10" oninput="calcMatchVB(${i},${s.prob},this)" style="width:100%"/>
        </div>
        <div style="text-align:center" id="mvb-value-${i}">
          <div style="font-size:11px;color:rgba(168,240,255,.25)">‚Äî</div>
        </div>
        <div style="text-align:center" id="mvb-mise-${i}">
          <div style="font-size:11px;color:rgba(168,240,255,.2)">‚Äî</div>
        </div>
      </div>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EVENT HANDLERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function tryUnlock() {
  const pin=document.getElementById('pin-input').value;
  if(pin==='1310') {
    document.getElementById('lock-screen').style.display='none';
    showHub();
  } else {
    const inp=document.getElementById('pin-input');
    inp.classList.add('error');
    document.getElementById('pin-error').style.opacity='1';
    inp.value='';
    setTimeout(()=>{inp.classList.remove('error');document.getElementById('pin-error').style.opacity='0';},2000);
  }
}
document.getElementById('pin-input').addEventListener('keypress',e=>{if(e.key==='Enter') tryUnlock();});

function showHub() {
  document.getElementById('hub').style.display='block';
  renderHub();
}
function renderHub() {
  const grid=document.getElementById('hub-grid');
  grid.innerHTML=Object.values(LEAGUES).map(l=>{
    let saved=0;
    try{const raw=localStorage.getItem(l.lsKey)||'';if(raw.trim()){const tmp=S.league;S.league=l.id;saved=parseSchedule(raw).length;S.league=tmp;}}catch{}
    return `<div class="hub-card" onclick="selectLeague('${l.id}')" style="border-color:${l.accent}22" onmouseover="this.style.borderColor='${l.accent}66';this.style.boxShadow='0 12px 40px rgba(0,0,0,.5),0 0 40px ${l.accentShadow}';this.style.background='rgba(5,16,34,.95)'" onmouseout="this.style.borderColor='${l.accent}22';this.style.boxShadow='none';this.style.background='rgba(5,16,34,.85)'">
      <div style="position:absolute;inset:0;border-radius:16px;background:radial-gradient(ellipse 80% 80% at 50% 0%,${l.accent}12,transparent 70%)"></div>
      <div style="position:relative;z-index:1">
        <div style="font-size:40px;margin-bottom:8px;filter:drop-shadow(0 0 12px ${l.accent})">${l.flag}</div>
        <div style="font-family:'Cinzel',serif;font-size:26px;font-weight:900;letter-spacing:5px;color:${l.accent};text-shadow:0 0 20px ${l.accentShadow};margin-bottom:4px">${l.label}</div>
        <div style="font-size:10px;color:rgba(168,240,255,.4);letter-spacing:2px;margin-bottom:16px">${l.desc}</div>
        ${saved>0?`<div style="padding:4px 14px;border-radius:20px;background:${l.accent}18;border:1px solid ${l.accent}44;color:${l.accent};font-size:11px;font-weight:700;letter-spacing:1px;display:inline-block">${saved} matchs sauvegard√©s</div>`:''}
        <div style="margin-top:16px;padding:10px 24px;border-radius:8px;border:1px solid ${l.accent}44;background:${l.accent}0d;color:${l.accent};font-family:'Cinzel',serif;font-size:11px;font-weight:700;letter-spacing:3px;display:inline-block">ACC√âDER ‚Üí</div>
      </div>
    </div>`;
  }).join('');
}
function selectLeague(id) {
  S.league=id;
  S.players=[...cfg().defaultPlayers];
  S.teamStats={...cfg().defaultStats};
  S.schedule=[];
  S.view='standings';
  S.selectedMatch=null;

  // Restaure calendrier manuel depuis localStorage (SYNC Zone B)
  if(id !== 'nhl') {
    try{
      const saved=localStorage.getItem(cfg().lsKey)||'';
      if(saved.trim()) {
        const parsed=parseSchedule(saved);
        if(parsed.length>0) S.schedule=parsed.map(m=>({...m,status:'upcoming',hs:null,as:null}));
      }
    }catch{}
  }

  document.getElementById('hub').style.display='none';
  document.getElementById('dashboard').style.display='block';
  document.getElementById('float-vb-btn').style.display='flex';
  updateDashHeader();
  render();
  startClock();

  // Chargement automatique des donn√©es API pour LIIGA et AHL
  // Le SYNC manuel reste toujours prioritaire (il √©crase ces donn√©es)
  if(id === 'liiga' || id === 'ahl') {
    autoLoadLeagueData(id);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTO-LOAD : charge data/liiga.json ou data/ahl.json depuis GitHub
// Matchs + classements uniquement ‚Äî les stats joueurs restent SYNC manuel
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function autoLoadLeagueData(leagueId) {
  // Badge de chargement discret
  showApiBadge('‚è≥ Chargement API...', '#4dd9f5', false);

  try {
    const res = await fetch(`data/${leagueId}.json?_=${Date.now()}`);
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();

    let schedLoaded = false;
    let standLoaded = false;

    // ‚îÄ‚îÄ CALENDRIER : seulement si le SYNC manuel est vide ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Si l'utilisateur a d√©j√† mis des matchs via SYNC, on ne les √©crase pas
    const hasSyncSchedule = S.schedule.length > 0;
    if(!hasSyncSchedule && data.schedule && data.schedule.length > 0) {
      const newSched = [];
      for(const day of data.schedule) {
        for(const g of (day.games || [])) {
          // Mappe les noms d'√©quipes vers les IDs Empire
          const homeId = matchTeamId(g.homeTeam) || g.homeTeam;
          const awayId = matchTeamId(g.awayTeam) || g.awayTeam;
          const status = g.status === 'Final' ? 'final'
                       : g.status === 'Live'  ? 'live'
                       : 'upcoming';
          newSched.push({
            home: homeId, away: awayId,
            date: day.date, time: g.time || '',
            status, hs: g.homeScore ?? null, as: g.awayScore ?? null
          });
        }
      }
      if(newSched.length > 0) {
        S.schedule = newSched;
        schedLoaded = true;
      }
    }

    // ‚îÄ‚îÄ CLASSEMENTS : seulement si le SYNC standings est vide ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Compare avec les defaultStats pour savoir si SYNC a d√©j√† √©t√© appliqu√©
    if(data.standings && data.standings.length > 0) {
      const newStats = {};
      for(const t of data.standings) {
        const teamId = matchTeamId(t.name) || t.name;
        if(!teamId) continue;
        const existing = S.teamStats[teamId] || {};
        // Si SYNC a d√©j√† rempli des vraies donn√©es (pts > default), on ne touche pas
        const isDefaultData = !existing.pts || existing === cfg().defaultStats[teamId];
        if(isDefaultData) {
          newStats[teamId] = {
            gp: t.gp || 0,
            w: t.wins || 0,
            l: t.losses || 0,
            otl: t.otLosses || t.draws || 0,
            pts: t.points || 0,
            gf: t.gf || 0,
            ga: t.ga || 0,
            pct: t.gp > 0 ? Math.round((t.points||0) / t.gp / 2 * 100) : 0,
            ppPct: existing.ppPct || 20.0,
            pkPct: existing.pkPct || 80.0,
            shotsFor: existing.shotsFor || 28.0,
            shotsAgainst: existing.shotsAgainst || 28.5,
            form: existing.form || [1,1,0,1,0],
            streak: existing.streak || ''
          };
        }
      }
      if(Object.keys(newStats).length > 0) {
        S.teamStats = {...S.teamStats, ...newStats};
        standLoaded = true;
      }
    }

    // Mise √† jour affichage
    if(schedLoaded || standLoaded) {
      const parts = [];
      if(schedLoaded) parts.push(S.schedule.filter(m=>m.status!=='final').length + ' matchs');
      if(standLoaded) parts.push('classement');
      const ts = new Date(data.updatedAt);
      const timeStr = ts.toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'});
      showApiBadge('‚úì API ' + parts.join(' ¬∑ ') + ' ¬∑ ' + timeStr, '#00f5a0', true);
      render();
      updateDashHeader();
    } else if(!hasSyncSchedule) {
      showApiBadge('‚ö† Donn√©es API vides ‚Äî lancez GitHub Actions', '#f0c84a', false);
    } else {
      // Donn√©es SYNC en place, API ignor√©e silencieusement
      showApiBadge('‚úì Donn√©es SYNC actives', cfg().accent, true);
    }

  } catch(err) {
    // Fichier non trouv√© = GitHub Actions pas encore lanc√©
    if(err.message.includes('404') || err.message.includes('HTTP')) {
      showApiBadge('‚ö° SYNC manuel requis ‚Äî ou lancez GitHub Actions', '#f0c84a', false);
    } else {
      showApiBadge('‚ö† Erreur API ‚Äî mode SYNC manuel', '#f0c84a', false);
    }
    console.log('autoLoad info:', err.message);
  }
}

// Badge discret dans le header pour indiquer l'√©tat de l'API
function showApiBadge(msg, color, autoHide) {
  let badge = document.getElementById('api-status-badge');
  if(!badge) {
    badge = document.createElement('span');
    badge.id = 'api-status-badge';
    badge.style.cssText = 'font-size:9px;letter-spacing:1.5px;padding:3px 10px;border-radius:5px;font-weight:700;transition:opacity .5s;margin-left:8px';
    const cnt = document.getElementById('upcoming-count');
    if(cnt && cnt.parentNode) cnt.parentNode.insertBefore(badge, cnt);
  }
  badge.textContent = msg;
  badge.style.color = color;
  badge.style.background = color.replace('#','rgba(') + ',0.1)'.replace('rgba(','rgba(').replace('rgba(rgba(','rgba(');
  badge.style.border = `1px solid ${color}44`;
  badge.style.opacity = '1';
  if(autoHide) setTimeout(() => { badge.style.opacity = '0'; }, 4000);
}
function goHub() {
  document.getElementById('dashboard').style.display='none';
  document.getElementById('float-vb-btn').style.display='none';
  document.getElementById('float-drawer').style.display='none';
  document.getElementById('hub').style.display='block';
  S.vbDrawerOpen=false;
  renderHub();
}
function updateDashHeader() {
  const c=cfg();
  document.getElementById('dash-title').textContent=c.label;
  document.getElementById('dash-title').style.color=c.accent;
  document.getElementById('aurora-line').style.background=`linear-gradient(90deg,transparent,${c.accentDark} 20%,${c.accent} 40%,rgba(212,248,255,.8) 50%,${c.accent} 70%,transparent)`;
  document.getElementById('back-btn').style.borderColor=c.accent+'44';
  document.getElementById('back-btn').style.color=c.accent;
  document.getElementById('sync-btn').style.borderColor=c.accent+'66';
  document.getElementById('sync-btn').style.color=c.accent;
  document.getElementById('sync-btn').innerHTML=S.league==='nhl'?'<span>üì•</span> NHL DATA':'<span>‚ö°</span> SYNC';
  document.getElementById('upcoming-count').style.color=c.accent+'aa';
  document.getElementById('dash-clock').style.color=c.accent;
  document.getElementById('dash-clock').style.textShadow=`0 0 8px ${c.accentShadow}`;
  ['standings','schedule','players'].forEach(v=>{
    const btn=document.getElementById('nav-'+v);
    btn.style.borderColor=c.accent+(S.view===v?'aa':'33');
    btn.style.background=S.view===v?c.accent+'22':'transparent';
    btn.style.color=S.view===v?c.accent:c.accent+'66';
    btn.style.boxShadow=S.view===v?`0 0 12px ${c.accentShadow}44`:'none';
  });
  const upcoming=S.schedule.filter(m=>m.status==='upcoming').length;
  document.getElementById('upcoming-count').textContent=`${upcoming} matchs √† venir`;
}
function setView(v) {
  S.view=v;
  S.selectedMatch=null;
  updateDashHeader();
  render();
}
function setSortBy(key) {
  S.sortStandings=key;
  render();
}
function openMatch(mStr) {
  const m=typeof mStr==='string'?JSON.parse(mStr):mStr;
  S.selectedMatch=m;
  S.view='match';
  updateDashHeader();
  render();
}
function render() {
  const c=document.getElementById('view-container');
  c.className='reveal';
  void c.offsetWidth;
  if(S.view==='standings') c.innerHTML=renderStandings();
  else if(S.view==='schedule') c.innerHTML=renderSchedule();
  else if(S.view==='players') c.innerHTML=renderPlayers();
  else if(S.view==='match'&&S.selectedMatch) c.innerHTML=renderMatch(S.selectedMatch);

}

let matchVBData={};
function toggleMatchVB() {
  const body=document.getElementById('match-vb-body');
  const arrow=document.getElementById('match-vb-arrow');
  if(body.style.display==='none'){body.style.display='block';arrow.style.transform='rotate(180deg)';}
  else{body.style.display='none';arrow.style.transform='none';}
}
function calcMatchVB(idx,prob,input) {
  const cote=parseFloat(input.value);
  const valEl=document.getElementById('mvb-value-'+idx);
  const miseEl=document.getElementById('mvb-mise-'+idx);
  const rowEl=document.getElementById('mvb-row-'+idx);
  if(!cote||isNaN(cote)||cote<=1){
    valEl.innerHTML='<div style="font-size:11px;color:rgba(168,240,255,.25)">‚Äî</div>';
    miseEl.innerHTML='<div style="font-size:11px;color:rgba(168,240,255,.2)">‚Äî</div>';
    rowEl.style.background='rgba(6,20,40,.6)';rowEl.style.borderColor='rgba(77,217,245,.08)';return;
  }
  const value=(prob*cote)/100;
  const isVal=value>1.05;
  const kelly=kellyCalc(prob,cote);
  const conf=S.selectedMatch?calcGoals(S.selectedMatch.home,S.selectedMatch.away).confidence:'MOYENNE';
  const mise=isVal?getMise(kelly,conf):null;
  valEl.innerHTML=`<div style="font-family:'Cinzel',serif;font-size:20px;font-weight:900;color:${isVal?'#00f5a0':'rgba(168,240,255,.3)'};text-shadow:${isVal?'0 0 12px rgba(0,245,160,.6)':'none'}">${value.toFixed(3)}</div><div style="font-size:8px;color:rgba(168,240,255,.35);letter-spacing:1px">VALUE${isVal?' ‚úì':''}</div>`;
  if(mise) {
    miseEl.innerHTML=`<div style="font-family:'Cinzel',serif;font-size:16px;font-weight:900;color:${mise.col}">${mise.pct}%</div><div style="font-size:8px;letter-spacing:1px;color:${mise.col};font-weight:700">${mise.label}</div>`;
  } else {
    miseEl.innerHTML='<div style="font-size:11px;color:rgba(168,240,255,.2)">‚Äî</div>';
  }
  if(isVal) {rowEl.style.background='rgba(0,245,160,.06)';rowEl.style.borderColor='rgba(0,245,160,.3)';}
  else {rowEl.style.background='rgba(6,20,40,.6)';rowEl.style.borderColor='rgba(77,217,245,.08)';}
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VALUE BET DRAWER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const VBHints={victoire:'Cote victoire d\'une √©quipe',buteur:'Joueur marque au moins 1 but',passeur:'Joueur d√©livre au moins 1 passe'};
function setVBType(t) {
  S.vbType=t;
  ['victoire','buteur','passeur'].forEach(k=>{
    const btn=document.getElementById('vbt-'+k);
    if(k===t){btn.style.background='rgba(77,217,245,.12)';btn.style.borderColor='rgba(77,217,245,.55)';btn.style.color='#4dd9f5';}
    else{btn.style.background='transparent';btn.style.borderColor='rgba(77,217,245,.15)';btn.style.color='rgba(168,240,255,.4)';}
  });
  document.getElementById('vb-hint').textContent=VBHints[t];
  calcVB();
}
function toggleVBDrawer() {
  S.vbDrawerOpen=!S.vbDrawerOpen;
  document.getElementById('float-drawer').style.display=S.vbDrawerOpen?'block':'none';
}
function calcVB() {
  const cote=parseFloat(document.getElementById('vb-cote').value);
  const prob=parseFloat(document.getElementById('vb-prob').value);
  const res=document.getElementById('vb-result');
  const btn=document.getElementById('float-vb-btn');
  const drawer=document.getElementById('float-drawer');
  if(isNaN(cote)||cote<=1||isNaN(prob)||prob<=0||prob>100) {
    res.innerHTML='<div style="font-size:13px;color:rgba(168,240,255,.3);letter-spacing:2px">‚Üë Entre la cote et la probabilit√©</div>';
    btn.classList.remove('has-value');drawer.classList&&drawer.classList.remove('has-value');
    btn.querySelector('span:last-child').textContent='BET';return;
  }
  const value=(prob*cote)/100;
  const isVal=value>1.05;
  const kelly=kellyCalc(prob,cote);
  const mise=isVal?getMise(kelly,'MOYENNE'):null;
  if(isVal){btn.classList.add('has-value');drawer.style.borderColor='rgba(0,245,160,.4)';}
  else{btn.classList.remove('has-value');drawer.style.borderColor='rgba(77,217,245,.25)';}
  btn.querySelector('span:last-child').textContent=isVal?'VALUE!':'BET';
  res.innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;text-align:center;margin-bottom:10px">
    <div><div style="font-family:'Cinzel',serif;font-size:24px;font-weight:900;line-height:1;color:${isVal?'#00f5a0':'rgba(168,240,255,.35)'}">${value.toFixed(3)}</div><div style="font-size:8px;letter-spacing:2px;color:rgba(168,240,255,.3);margin-top:3px">VALUE</div></div>
    <div><div style="font-family:'Cinzel',serif;font-size:24px;font-weight:900;line-height:1;color:${kelly>0?'#f0c84a':'rgba(168,240,255,.25)'}">${(kelly*100).toFixed(1)}%</div><div style="font-size:8px;letter-spacing:2px;color:rgba(168,240,255,.3);margin-top:3px">KELLY BRUT</div></div>
    <div><div style="font-family:'Cinzel',serif;font-size:24px;font-weight:900;line-height:1;color:${mise?mise.col:'rgba(168,240,255,.25)'}">${mise?mise.pct+'%':'‚Äî'}</div><div style="font-size:8px;letter-spacing:2px;color:rgba(168,240,255,.3);margin-top:3px">MISE /CAPITAL</div></div>
  </div>
  ${isVal?`<div class="value-glow" style="display:flex;align-items:center;justify-content:center;gap:8px;padding:7px 14px;border-radius:20px;background:rgba(0,245,160,.12);border:1px solid rgba(0,245,160,.5)"><span>üíµ</span><span style="font-family:'Cinzel',serif;font-size:11px;font-weight:900;color:#00f5a0;letter-spacing:2px">VALUE D√âTECT√âE</span><span style="font-size:10px;color:rgba(0,245,160,.7)">+${((value-1)*100).toFixed(1)}%</span>${mise?`<span style="font-size:10px;font-weight:700;color:${mise.col}">¬∑ ${mise.label}</span>`:''}
  </div>`:
  `<div style="display:flex;align-items:center;justify-content:center;gap:6px;padding:6px 12px;border-radius:20px;background:rgba(168,240,255,.03);border:1px solid rgba(168,240,255,.1)"><span>üìâ</span><span style="font-family:'Cinzel',serif;font-size:10px;color:rgba(168,240,255,.35);letter-spacing:1px;font-weight:700">PAS DE VALUE ‚Äî √âVITER</span></div>`}`;
}
function resetVB() {
  document.getElementById('vb-cote').value='';
  document.getElementById('vb-prob').value='';
  calcVB();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SYNC ‚Äî 5 zones : standings ¬∑ buts ¬∑ passes ¬∑ points ¬∑ calendrier
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// R√©sultats pars√©s par zone
const syncResults = { standings: null, goals: null, assists: null, points: null };
let syncZoneBResult = null;

function openSync() {
  // Met √† jour le titre avec la couleur de la ligue active
  const c = cfg();
  const title = document.getElementById('sync-title');
  const sub   = document.getElementById('sync-subtitle');
  if(title) { title.style.color = c.accent; }
  if(sub)   { sub.textContent = c.label + ' ¬∑ Standings ¬∑ Buts ¬∑ Passes ¬∑ Points ¬∑ Calendrier'; }
  document.getElementById('sync-overlay').style.display = 'block';
  // Restaure Zone B depuis localStorage
  try { document.getElementById('zone-b').value = localStorage.getItem(c.lsKey) || ''; } catch{}
  parseZoneB();
}
function closeSync() { document.getElementById('sync-overlay').style.display = 'none'; }

// ‚îÄ‚îÄ Utilitaire : badge de validation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function _setTag(tagId, ok, msg) {
  const tag = document.getElementById(tagId);
  if(!tag) return;
  tag.style.display = 'block';
  if(ok) {
    tag.style.background = 'rgba(0,245,160,.12)'; tag.style.border = '1px solid rgba(0,245,160,.4)'; tag.style.color = '#00f5a0';
  } else {
    tag.style.background = 'rgba(255,68,102,.12)'; tag.style.border = '1px solid rgba(255,68,102,.4)'; tag.style.color = '#ff4466';
  }
  tag.textContent = msg;
}
function _clearTag(tagId) {
  const tag = document.getElementById(tagId);
  if(tag) { tag.style.display = 'none'; tag.textContent = ''; }
}

// ‚îÄ‚îÄ Parseur texte libre ‚Üí tableau de joueurs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function _parsePlayerText(raw, statKey) {
  // ‚îÄ‚îÄ 1. Essai JSON ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  try {
    const d = JSON.parse(raw);
    const list = d[statKey] || d.points || d.goals || d.assists || [];
    if(Array.isArray(list) && list.length > 0) {
      return list.map(p => {
        const name = ((p.firstName?.default||p.firstName||'') + ' ' + (p.lastName?.default||p.lastName||'')).trim()
                     || p.name || p.playerName || '';
        const team = p.teamAbbrev?.default || p.teamAbbrev || p.team || '';
        const empireTeam = matchTeamId(team) || team;
        const gp  = p.gamesPlayed || p.gp || 1;
        const g   = statKey==='goals'   ? (p.value??p.goals??0)   : (p.goals??0);
        const a   = statKey==='assists' ? (p.value??p.assists??0)  : (p.assists??0);
        const pts = statKey==='points'  ? (p.value??p.points??0)   : (p.points??g+a);
        const ratio = gp > 0 ? Math.round((pts/gp)*1000)/1000 : 0;
        if(!name || !empireTeam) return null;
        return { n:name, t:empireTeam, nat:'CA', age:p.age||25,
                 pos: p.position||p.positionCode||'F',
                 gp, g, a, pts, pim:p.penaltyMinutes||0, pm:p.plusMinus||0, ppg:p.powerPlayGoals||0, ratio };
      }).filter(Boolean);
    }
  } catch(_) {}

  // ‚îÄ‚îÄ 2. Parseur HTML Liiga (liiga.fi) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // D√©tecte la pr√©sence des IDs sp√©cifiques au tableau liiga.fi
  if (raw.includes('player-statistics-stat-fullName') || raw.includes('player-statistics-stat-data-')) {
    const parser = new DOMParser();
    const doc    = parser.parseFromString(raw, 'text/html');

    // S√©lectionne toutes les lignes du tableau ‚Äî compatible les deux versions du site :
    //   Ancienne version : id="player-statistics-stat-data-0"
    //   Nouvelle version EN : class*="_dataContainerWithHover_"  (pas d'id data-N)
    let rows = doc.querySelectorAll('[id^="player-statistics-stat-data-"]');
    if (rows.length === 0) {
      // Nouvelle version : on prend tous les conteneurs de ligne qui contiennent un fullName
      rows = Array.from(doc.querySelectorAll('[class*="_dataContainerWithHover_"]'))
        .filter(el => el.querySelector('[id^="player-statistics-stat-fullName-"]'));
    }

    if (rows.length > 0) {
      const seen = new Set(); // √©vite les doublons (lignes "Tot." ou sous-√©quipes)
      const liigaPlayers = Array.from(rows).map(row => {
        // ‚îÄ‚îÄ Nom : innerText retire les &nbsp; mieux que textContent ‚îÄ‚îÄ
        // Les IDs peuvent √™tre  "...-0"  OU  "...-0-0"  selon la version du site
        const nameEl    = row.querySelector('[id^="player-statistics-stat-fullName-"]');
        const teamEl    = row.querySelector('[id^="player-statistics-stat-teamShortName-"]');
        const roleEl    = row.querySelector('[id^="player-statistics-stat-role-"]');
        const gamesEl   = row.querySelector('[id^="player-statistics-stat-games-"]');
        const goalsEl   = row.querySelector('[id^="player-statistics-stat-goals-"]');
        const assistsEl = row.querySelector('[id^="player-statistics-stat-assists-"]');
        const pointsEl  = row.querySelector('[id^="player-statistics-stat-points-"]');
        const pimEl     = row.querySelector('[id^="player-statistics-stat-penaltyMinutes-"]');
        const pmEl      = row.querySelector('[id^="player-statistics-stat-plusMinus-"]');
        const ppgEl     = row.querySelector('[id^="player-statistics-stat-powerplayGoals-"]');

        // Nettoyage du nom : retire "1. " / "12. " (ta logique)
        const rawName  = nameEl ? (nameEl.innerText || nameEl.textContent || '').trim() : '';
        const cleanName = rawName.replace(/^\d{1,3}\.\s*/, '').trim();

        const teamRaw  = teamEl ? (teamEl.innerText || teamEl.textContent || '').trim() : '';
        const roleRaw  = roleEl ? (roleEl.innerText || roleEl.textContent || '').trim() : '';

        const gp  = parseInt(gamesEl   ? gamesEl.innerText   || gamesEl.textContent   : '1') || 1;
        const g   = parseInt(goalsEl   ? goalsEl.innerText   || goalsEl.textContent   : '0') || 0;
        const a   = parseInt(assistsEl ? assistsEl.innerText || assistsEl.textContent : '0') || 0;
        const pts = parseInt(pointsEl  ? pointsEl.innerText  || pointsEl.textContent  : '0') || (g + a);
        const pim = parseInt(pimEl     ? pimEl.innerText     || pimEl.textContent     : '0') || 0;
        const pm  = parseInt(pmEl      ? pmEl.innerText      || pmEl.textContent      : '0') || 0;
        const ppg = parseInt(ppgEl     ? ppgEl.innerText     || ppgEl.textContent     : '0') || 0;

        // Position : OL/VL/KH ‚Üí F  |  PV ‚Üí D  |  MV ‚Üí G
        let pos = 'F';
        if      (/^MV$/i.test(roleRaw)) pos = 'G';
        else if (/^PV$/i.test(roleRaw)) pos = 'D';

        // √âquipe : normalise via matchTeamId, sinon garde le tricode Liiga brut
        const teamId = matchTeamId(teamRaw) || teamRaw || '?';

        // Stat principale selon la zone o√π l'utilisateur a coll√© le HTML
        const gFinal   = g;
        const aFinal   = a;
        const ptsFinal = statKey === 'goals'   ? g
                       : statKey === 'assists' ? a
                       : pts;

        const ratio = gp > 0 ? Math.round((ptsFinal / gp) * 1000) / 1000 : 0;

        // Ignore les lignes sans nom (sous-lignes "Tot." des joueurs √©chang√©s)
        if (!cleanName || cleanName.length < 3) return null;
        // Ignore les √©quipes "Tot." (total multi-√©quipes ‚Äî ligne agr√©g√©e)
        if (teamRaw === 'Tot.') return null;
        // D√©doublonne par nom
        const nameKey = cleanName.toLowerCase();
        if (seen.has(nameKey)) return null;
        seen.add(nameKey);
        return {
          n: cleanName, t: teamId, nat: 'FI', age: 25, pos,
          gp, g: gFinal, a: aFinal, pts: ptsFinal, pim, pm, ppg, ratio
        };
      }).filter(Boolean);

      if (liigaPlayers.length > 0) return liigaPlayers;
    }
  }

  // ‚îÄ‚îÄ 3. Texte libre ‚Äî copier-coll√© depuis site web ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // G√®re tous ces formats :
  //   1. MacKinnon, Nathan  COL  F  50  40  30  70
  //   1  Nathan MacKinnon   COL  70  40  30
  //   MacKinnon N.          Karpat  D  55  12
  //   1. Tappara | Mikko Lehtonen | D | 50 | 12 | 34
  const players = [];

  for(let line of raw.split(/\r?\n/)) {
    line = line.trim();
    if(!line || line.length < 3) continue;

    // Supprime rang en d√©but : "1.", "1)", "#1", "1 "
    line = line.replace(/^#?\d{1,3}[\.\)\-\s]\s*/, '').trim();
    if(!line) continue;

    // Normalise s√©parateurs
    line = line.replace(/\|/g, ' ').replace(/\t/g, ' ');

    // Extrait tous les entiers de la ligne
    const allNums = [...line.matchAll(/(?<![.\d])\b(\d{1,3})\b(?![.\d%])/g)]
      .map(m => parseInt(m[1])).filter(n => n >= 0 && n <= 200);

    // Supprime les nombres et ponctuation pour isoler le texte
    const textOnly = line.replace(/(?<![.\d])\b\d{1,3}\b(?![.\d%])/g, ' ')
                         .replace(/[,;]/g, ' ').replace(/\s{2,}/g, ' ').trim();
    const tokens = textOnly.split(/\s+/).filter(t => t.length > 0);

    // Cherche √©quipe parmi les tokens
    let teamId = null;
    let teamTokenIdx = -1;
    for(let i = 0; i < tokens.length; i++) {
      const tid = matchTeamId(tokens[i]);
      if(tid) { teamId = tid; teamTokenIdx = i; break; }
    }

    // Cherche position
    let pos = 'F';
    const posIdx = tokens.findIndex(t => /^(F|D|G|LW|RW|C)$/i.test(t));
    if(posIdx !== -1) pos = tokens[posIdx][0].toUpperCase();

    // Reconstruit le nom sans √©quipe ni position
    const nameTokens = tokens.filter((t, i) => {
      if(i === teamTokenIdx) return false;
      if(i === posIdx) return false;
      if(t.length === 1 && t !== t.toLowerCase()) return false; // initiale isol√©e
      return true;
    });

    // G√®re "Nom, Pr√©nom" ‚Üí "Pr√©nom Nom" et retire les points d'initiale
    let nameFull = nameTokens.join(' ')
      .replace(/^([A-Za-z√Ä-√∂√∏-√ø\-]+),\s*([A-Za-z√Ä-√∂√∏-√ø\-]+)/, '$2 $1')
      .replace(/\b([A-Z])\./g, '$1').trim();

    if(!nameFull || nameFull.length < 3) continue;

    // Si √©quipe non trouv√©e, cherche token 2-4 majuscules
    if(!teamId) {
      const maybeTeam = tokens.find(t => /^[A-Z√Ä√Ç√â√à√ä√ã√é√è√î√ô√õ√ú]{2,4}$/.test(t) && t !== nameFull.split(' ')[0]);
      if(maybeTeam) teamId = maybeTeam;
      else teamId = '?';
    }

    // D√©code les stats selon statKey
    let gp=1, g=0, a=0, pts=0;
    if(statKey === 'goals') {
      if(allNums.length >= 2)      { gp=allNums[0]; g=allNums[allNums.length-1]; }
      else if(allNums.length === 1) { g=allNums[0]; }
      pts = g;
    } else if(statKey === 'assists') {
      if(allNums.length >= 2)      { gp=allNums[0]; a=allNums[allNums.length-1]; }
      else if(allNums.length === 1) { a=allNums[0]; }
      pts = a;
    } else { // points
      if(allNums.length >= 4)      { gp=allNums[0]; g=allNums[1]; a=allNums[2]; pts=allNums[3]; }
      else if(allNums.length >= 3) { gp=allNums[0]; g=allNums[1]; a=allNums[2]; pts=g+a; }
      else if(allNums.length >= 2) { gp=allNums[0]; pts=allNums[allNums.length-1]; g=Math.round(pts*0.45); a=pts-g; }
      else if(allNums.length === 1) { pts=allNums[0]; g=Math.round(pts*0.45); a=pts-g; }
    }
    if(gp < 1) gp = 1;
    const ratio = Math.round((pts/gp)*1000)/1000;

    players.push({ n:nameFull, t:teamId, nat:'CA', age:25, pos,
                   gp, g, a, pts, pim:0, pm:0, ppg:0, ratio });
  }
  return players;
}
// ‚îÄ‚îÄ Parseur standings texte libre ‚Üí teamStats ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function _parseStandingsText(raw) {
  // Essaie JSON
  try {
    const d = JSON.parse(raw);
    const list = d.standings || d.teams || d.data || [];
    if(Array.isArray(list) && list.length > 0) return { type:'json', data: list };
  } catch(_) {}

  // ‚îÄ‚îÄ Parseur HTML Liiga (liiga.fi team stats) ‚îÄ‚îÄ
  if(raw.includes('team-statistics-stat-name-') || raw.includes('team-statistics-grid-header')) {
    try {
      const parser = new DOMParser();
      const doc = parser.parseFromString('<div>' + raw + '</div>', 'text/html');
      const teams = [];
      let i = 0;
      while(true) {
        const nameEl = doc.querySelector(`[id^="team-statistics-stat-name-${i}-"]`);
        if(!nameEl) break;
        const imgEl = nameEl.querySelector('img[alt]');
        const rawName = imgEl ? imgEl.alt : (nameEl.querySelector('[class*="TeamName"]')?.textContent || '');
        const teamId = matchTeamId(rawName) || rawName;

        const getStat = (key) => {
          const el = doc.querySelector(`[id^="team-statistics-stat-${key}-${i}-"]`);
          if(!el) return 0;
          return parseFloat(el.textContent.replace(/\s/g,'').replace(',','.')) || 0;
        };

        // Last 5 results from SVG circles
        const l5El = doc.querySelector(`[id^="team-statistics-stat-last5Results-${i}-"]`);
        const form = [];
        if(l5El) {
          const svgs = l5El.querySelectorAll('svg');
          svgs.forEach(svg => {
            const txt = svg.querySelector('text')?.textContent?.trim();
            if(txt === 'W') form.push(1);
            else if(txt === 'OT') form.push(0.5);
            else form.push(0);
          });
        }

        const gp = getStat('games');
        const w  = getStat('wins');
        const t  = getStat('ties');  // OT wins
        const l  = getStat('losses');
        const pts= getStat('points');
        const gf = getStat('goalsFor');
        const ga = getStat('goalsAgainst');

        // Streak from form
        let streak = '';
        if(form.length) {
          const last = form[form.length-1];
          let cnt = 1;
          for(let j = form.length-2; j >= 0; j--) {
            if(form[j] === last) cnt++; else break;
          }
          streak = (last===1?'W':last===0.5?'OT':'L') + cnt;
        }

        // win% for pct
        const pct = gp > 0 ? Math.round((pts / (gp*2))*100) : 50;

        teams.push({ id: teamId, gp, w, l, otl: t, pts, gf, ga, streak, form, pct });
        i++;
      }
      if(teams.length > 0) return { type:'liigaHtml', data: teams };
    } catch(e) { console.warn('Liiga standings HTML parse error', e); }
  }

  // Texte ligne par ligne
  const teams = [];
  for(const line of raw.split(/\r?\n/).filter(l => l.trim())) {
    const cols = line.replace(/\|/g,' ').split(/[\t,;]+|\s{2,}/).map(c => c.trim()).filter(c => c);
    if(cols.length < 3) continue;
    let teamId=null;
    for(const col of cols) { const tid = matchTeamId(col); if(tid) { teamId=tid; break; } }
    if(!teamId) continue;
    const nums = cols.map(c => parseFloat(c)).filter(n => !isNaN(n) && n < 200);
    if(nums.length < 2) continue;
    let idx=0, gp=nums[idx]||55, w=nums[idx+1]||0, l=nums[idx+2]||0, otl=nums[idx+3]||0, pts=nums[idx+4]||0;
    if(!pts && w) pts = w*2 + otl;
    teams.push({ id:teamId, gp, w, l, otl, pts,
      gf:nums[idx+5]||150, ga:nums[idx+6]||150 });
  }
  return teams.length > 0 ? { type:'text', data: teams } : null;
}

// ‚îÄ‚îÄ parseSyncField : appel√© par oninput/onpaste ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function parseSyncField(field) {
  const ta  = document.getElementById('zone-' + field);
  const raw = ta ? ta.value.trim() : '';
  if(!raw) {
    syncResults[field] = null;
    if(ta) ta.className = 'sync-ta';
    _clearTag('tag-' + field);
    updateSyncBtn(); return;
  }

  if(field === 'standings') {
    const result = _parseStandingsText(raw);
    syncResults.standings = result;
    if(result) {
      ta.className = 'sync-ta ok';
      _setTag('tag-standings', true, '‚úì ' + result.data.length + ' √©quipes');
    } else {
      ta.className = 'sync-ta err';
      _setTag('tag-standings', false, '‚ö† Non reconnu');
    }
  } else {
    // goals / assists / points
    const players = _parsePlayerText(raw, field);
    syncResults[field] = players.length > 0 ? players : null;
    if(players.length > 0) {
      ta.className = 'sync-ta ok';
      _setTag('tag-' + field, true, '‚úì ' + players.length + ' joueurs');
    } else {
      ta.className = 'sync-ta err';
      _setTag('tag-' + field, false, '‚ö† Non reconnu');
    }
  }
  updateSyncBtn();
}

// ‚îÄ‚îÄ Zone B : calendrier (inchang√©, persistant) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function parseZoneB() {
  const raw = document.getElementById('zone-b').value;
  const ta  = document.getElementById('zone-b');
  const tag = document.getElementById('zb-tag');
  try { localStorage.setItem(cfg().lsKey, raw); } catch{}
  if(!raw.trim()) { syncZoneBResult=null; ta.className='sync-ta'; _clearTag('zb-tag'); updateSyncBtn(); return; }
  const matches = parseSchedule(raw);
  syncZoneBResult = matches.length>0 ? matches.map(m=>({...m,status:'upcoming',hs:null,as:null})) : null;
  if(matches.length>0) {
    ta.className='sync-ta ok'; _setTag('zb-tag', true, '‚úì '+matches.length+' matchs');
  } else {
    ta.className='sync-ta err'; _setTag('zb-tag', false, '‚ö† Non reconnu');
  }
  updateSyncBtn();
}

// ‚îÄ‚îÄ updateSyncBtn ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateSyncBtn() {
  const btn = document.getElementById('sync-apply-btn');
  const hasAny = syncZoneBResult ||
                 syncResults.standings || syncResults.goals ||
                 syncResults.assists   || syncResults.points;
  btn.disabled = !hasAny;
  btn.textContent = hasAny ? '‚ö° APPLIQUER & LANCER' : 'COLLE DES DONN√âES D\'ABORD';
}

// ‚îÄ‚îÄ applySync : fusionne les 4 sources + Zone B ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function applySync() {
  // --- Standings ---
  if(syncResults.standings) {
    const res = syncResults.standings;
    const newStats = {};
    if(res.type === 'json') {
      // Format JSON API (NHL-like)
      for(const t of res.data) {
        const id = matchTeamId(t.abbrev||t.teamAbbrev||t.name||t.teamName||'') || t.id;
        if(!id) continue;
        const gp = t.gamesPlayed||(t.wins+t.losses+(t.otLosses||0));
        newStats[id] = {
          gp, w:t.wins||0, l:t.losses||0, otl:t.otLosses||0,
          pts:t.points||0, gf:t.goalFor||t.goalsFor||0, ga:t.goalAgainst||t.goalsAgainst||0,
          pct: gp>0?Math.round((t.points||0)/gp/2*100):0,
          ppPct: S.teamStats[id]?.ppPct||20.0,
          pkPct: S.teamStats[id]?.pkPct||80.0,
          homeW:t.homeWins||0, homeL:t.homeLosses||0,
          awayW:t.roadWins||0, awayL:t.roadLosses||0,
          form: S.teamStats[id]?.form||[1,1,0,1,0]
        };
      }
    } else {
      // Format texte ou liigaHtml pars√©
      for(const t of res.data) {
        const existing = S.teamStats[t.id] || {};
        newStats[t.id] = { ...existing,
          gp:t.gp, w:t.w, l:t.l, otl:t.otl, pts:t.pts, gf:t.gf, ga:t.ga,
          pct: t.pct || (t.gp>0?Math.round(t.pts/t.gp/2*100):0),
          ppPct: existing.ppPct||20.0, pkPct: existing.pkPct||80.0,
          form: t.form && t.form.length ? t.form : (existing.form||[1,1,0,1,0]),
          streak: t.streak || existing.streak || ''
        };
      }
    }
    if(Object.keys(newStats).length > 0) S.teamStats = { ...S.teamStats, ...newStats };
  }

  // --- Joueurs : fusion goals + assists + points ---
  const playerMap = {};
  function mergePlayerList(list, statKey) {
    if(!list) return;
    for(const p of list) {
      const key = p.n.toLowerCase();
      if(!playerMap[key]) { playerMap[key] = {...p}; }
      else {
        if(statKey==='goals')   playerMap[key].g   = p.g   || playerMap[key].g;
        if(statKey==='assists') playerMap[key].a   = p.a   || playerMap[key].a;
        if(statKey==='points')  playerMap[key].pts = p.pts || playerMap[key].pts;
      }
    }
  }
  mergePlayerList(syncResults.goals,   'goals');
  mergePlayerList(syncResults.assists, 'assists');
  mergePlayerList(syncResults.points,  'points');

  const newPlayers = Object.values(playerMap).map(p => {
    p.pts  = p.pts || (p.g + p.a);
    p.ratio = p.gp>0 ? Math.round((p.pts/p.gp)*1000)/1000 : 0;
    return p;
  });

  if(newPlayers.length > 0) {
    S.players = [...newPlayers, ...S.players.filter(p => p.pos==='G')];
  }

  // --- Calendrier ---
  if(syncZoneBResult) S.schedule = syncZoneBResult;

  const btn = document.getElementById('sync-apply-btn');
  btn.textContent = '‚úì APPLIQU√â !';
  setTimeout(() => { closeSync(); render(); updateDashHeader(); }, 700);
}

function applyDefaults() {
  S.players   = [...cfg().defaultPlayers];
  S.teamStats = {...cfg().defaultStats};
  S.schedule  = [];
  closeSync(); render(); updateDashHeader();
}

// ‚îÄ‚îÄ clearSyncField : efface une zone individuelle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function clearSyncField(field) {
  const ta = document.getElementById('zone-' + field);
  if(ta) { ta.value = ''; ta.className = 'sync-ta'; }
  syncResults[field] = null;
  _clearTag('tag-' + field);
  updateSyncBtn();
}

function clearZoneB() {
  document.getElementById('zone-b').value = '';
  try { localStorage.removeItem(cfg().lsKey); } catch{}
  syncZoneBResult = null;
  S.schedule = [];
  document.getElementById('zone-b').className = 'sync-ta';
  _clearTag('zb-tag');
  updateSyncBtn();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Mapping tricode NHL ‚Üí streakCode (W/L + nbr) utilis√© dans computeStrength via form[]
function parseNHLStreak(streakCode, streakCount) {
  if(!streakCode) return {streak:'‚Äî',form:[]};
  const type = streakCode === 'W' ? 1 : 0;
  const form = [];
  for(let i=0;i<Math.min(streakCount,5);i++) form.unshift(type);
  while(form.length<5) form.push(type===1?0:1);
  return {streak:`${streakCode}${streakCount}`, form};
}

// Mapping des positions NHL API
function mapNHLPos(posCode) {
  if(!posCode) return 'F';
  if(posCode==='D') return 'D';
  if(posCode==='G') return 'G';
  return 'F';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NHL ‚Äî CHARGEMENT MANUEL UNIQUEMENT (pas de fetch auto)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ Modale chargement manuel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openNHLManual() {
  document.getElementById('nhl-manual-overlay').style.display = 'block';
}
function closeNHLManual() {
  document.getElementById('nhl-manual-overlay').style.display = 'none';
}

function nhlManualValidate(field) {
  const ta  = document.getElementById('nhl-json-' + field);
  const tag = document.getElementById('nhl-tag-' + field);
  const raw = ta.value.trim();
  if(!raw) { ta.className='nhl-manual-ta'; tag.textContent=''; nhlManualUpdateBtn(); return; }
  try {
    const d = JSON.parse(raw);
    let count = 0;
    if(field === 'standings')     count = (d.standings||[]).length;
    else if(field === 'schedule') count = (d.gameWeek||[]).reduce((a,w)=>a+(w.games||[]).length, 0);
    else if(field === 'goals')    count = (d.goals||d.points||[]).length;
    else if(field === 'assists')  count = (d.assists||d.points||[]).length;
    else if(field === 'players')  count = (d.points||d.goals||d.assists||[]).length;
    ta.className='nhl-manual-ta ok';
    tag.style.color='#00f5a0';
    tag.textContent = '‚úì ' + count + ' entr√©es d√©tect√©es';
  } catch(e) {
    ta.className='nhl-manual-ta err';
    tag.style.color='#ff4466';
    tag.textContent = '‚úó JSON invalide';
  }
  nhlManualUpdateBtn();
}

function nhlManualUpdateBtn() {
  const btn = document.getElementById('nhl-manual-apply-btn');
  const hasValid = ['standings','schedule','goals','assists','players'].some(f => {
    const el = document.getElementById('nhl-json-' + f);
    if(!el) return false;
    const v = el.value.trim();
    if(!v) return false;
    try { JSON.parse(v); return true; } catch{ return false; }
  });
  btn.disabled = !hasValid;
  btn.style.opacity = hasValid ? '1' : '0.4';
  btn.style.cursor = hasValid ? 'pointer' : 'not-allowed';
  btn.textContent = hasValid ? 'APPLIQUER LES DONN√âES' : 'COLLE AU MOINS UN CHAMP D\'ABORD';
}

function nhlManualApply() {
  function tryParse(id) {
    const el = document.getElementById(id);
    if(!el) return null;
    const v = el.value.trim();
    if(!v) return null;
    try { return JSON.parse(v); } catch{ return null; }
  }
  const standings  = tryParse('nhl-json-standings');
  const schedule   = tryParse('nhl-json-schedule');
  const goalsRaw   = tryParse('nhl-json-goals');
  const assistsRaw = tryParse('nhl-json-assists');
  const pointsRaw  = tryParse('nhl-json-players');

  if(!standings && !schedule && !goalsRaw && !assistsRaw && !pointsRaw) {
    alert('Aucune donn√©e JSON valide d√©tect√©e. Collez au moins un champ.');
    return;
  }

  const btn = document.getElementById('nhl-manual-apply-btn');
  btn.textContent = '‚è≥ APPLICATION EN COURS...';
  btn.disabled = true;

  setTimeout(() => {
    applyNHLData(standings, schedule, pointsRaw, goalsRaw, assistsRaw);
    closeNHLManual();
  }, 100);
}

// ‚îÄ‚îÄ Fetch automatique SUPPRIM√â ‚Äî mode manuel uniquement ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// fetchNHL() remplac√©e par ouverture directe de la modale manuelle

// ‚îÄ‚îÄ Traitement commun : normalise + applique standings/schedule/players ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function applyNHLData(standingsRaw, scheduleRaw, playersRaw, goalsRaw, assistsRaw) {
  // Force la ligue NHL si n√©cessaire (sans refaire fetchNHL)
  if(S.league !== 'nhl') {
    S.league = 'nhl';
    S.players = [...LEAGUES.nhl.defaultPlayers];
    S.teamStats = {...LEAGUES.nhl.defaultStats};
    S.schedule = [];
    S.view = 'standings';
    document.getElementById('hub').style.display='none';
    document.getElementById('dashboard').style.display='block';
    const fvb = document.getElementById('float-vb-btn');
    if(fvb) fvb.style.display='flex';
    startClock();
    updateDashHeader();
  }
  standingsRaw = standingsRaw || {};
  scheduleRaw  = scheduleRaw  || {};
  playersRaw   = playersRaw   || {};
  goalsRaw     = goalsRaw     || {};
  assistsRaw   = assistsRaw   || {};

  const schedGames = [];
  for(const week of (scheduleRaw.gameWeek || [])) {
    const weekDate = week.date || '';
    for(const g of (week.games || [])) schedGames.push({...g, _weekDate: weekDate});
  }

  const nhlData = {
    standings: standingsRaw.standings || [],
    schedule: schedGames.map(g => ({
      date:         g.gameDate || g.date || g._weekDate || '',
      homeAbbrev:   g.homeTeam?.abbrev,
      awayAbbrev:   g.awayTeam?.abbrev,
      startTimeUTC: g.startTimeUTC,
      gameState:    g.gameState,
      homeScore:    g.homeTeam?.score ?? null,
      awayScore:    g.awayTeam?.score ?? null
    })),
    players: (playersRaw.points || playersRaw.goals || playersRaw.assists || []).map(p => ({
      firstName:      p.firstName?.default  || '',
      lastName:       p.lastName?.default   || '',
      teamAbbrev:     p.teamAbbrev?.default || p.teamAbbrev || '',
      positionCode:   p.position            || 'F',
      gamesPlayed:    p.gamesPlayed         || 0,
      goals:          p.goals               ?? p.value ?? 0,
      assists:        p.assists             ?? p.value ?? 0,
      points:         p.points              ?? p.value ?? 0,
      plusMinus:      p.plusMinus           || 0,
      penaltyMinutes: p.penaltyMinutes      || 0,
      powerPlayGoals: p.powerPlayGoals      || 0
    })),
    // Leaders s√©par√©s par cat√©gorie
    goalLeaders:   (goalsRaw.goals   || []).map(p => ({
      firstName: p.firstName?.default||'', lastName: p.lastName?.default||'',
      teamAbbrev: p.teamAbbrev?.default||p.teamAbbrev||'',
      positionCode: p.position||'F', gamesPlayed: p.gamesPlayed||0,
      goals: p.value??p.goals??0, assists: 0, points: p.value??p.goals??0,
      plusMinus:0, penaltyMinutes:0, powerPlayGoals:0
    })),
    assistLeaders: (assistsRaw.assists || []).map(p => ({
      firstName: p.firstName?.default||'', lastName: p.lastName?.default||'',
      teamAbbrev: p.teamAbbrev?.default||p.teamAbbrev||'',
      positionCode: p.position||'F', gamesPlayed: p.gamesPlayed||0,
      goals: 0, assists: p.value??p.assists??0, points: p.value??p.assists??0,
      plusMinus:0, penaltyMinutes:0, powerPlayGoals:0
    }))
  };

  let standingsDone = false, schedDone = false;

  // ‚îÄ‚îÄ STANDINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if(nhlData.standings && nhlData.standings.length > 0) {
    const newStats = {};
    for(const t of nhlData.standings) {
      const empireId = NHL_TRICODE_MAP[t.abbrev];
      if(!empireId) continue;
      const gp = t.gamesPlayed || (t.wins + t.losses + t.otLosses);
      const homeL = (t.homeLosses||0);
      const awayL = (t.roadLosses||0);
      const streakInfo = parseNHLStreak(t.streakCode, t.streakCount||0);
      newStats[empireId] = {
        gp, w: t.wins||0, l: t.losses||0, otl: t.otLosses||0,
        pts: t.points||0, gf: t.goalFor||0, ga: t.goalAgainst||0,
        pct: gp > 0 ? Math.round((t.points||0)/gp/2*100) : 0,
        ppPct: S.teamStats[empireId]?.ppPct || 20.5,
        pkPct: S.teamStats[empireId]?.pkPct || 81.0,
        shotsFor: S.teamStats[empireId]?.shotsFor || 30.0,
        shotsAgainst: S.teamStats[empireId]?.shotsAgainst || 29.5,
        homeW: t.homeWins||0, homeL,
        awayW: t.roadWins||0, awayL,
        streak: streakInfo.streak, form: streakInfo.form
      };
    }
    if(Object.keys(newStats).length > 0) {
      S.teamStats = {...S.teamStats, ...newStats};
      standingsDone = true;
    }
  }

  // ‚îÄ‚îÄ SCHEDULE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  if(nhlData.schedule && nhlData.schedule.length > 0) {
    const newSched = [];
    for(const g of nhlData.schedule) {
      const homeId = NHL_TRICODE_MAP[g.homeAbbrev];
      const awayId = NHL_TRICODE_MAP[g.awayAbbrev];
      if(!homeId || !awayId) continue;
      let time = null;
      if(g.startTimeUTC) {
        const d = new Date(g.startTimeUTC);
        time = d.toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit', timeZone:'America/New_York'});
      }
      const stateCode = g.gameState || 'FUT';
      const status = ['FINAL','OFF'].includes(stateCode) ? 'final' : 'upcoming';
      newSched.push({
        home: homeId, away: awayId, date: g.date || '', time, status,
        hs: g.homeScore ?? null, as: g.awayScore ?? null, liveState: stateCode
      });
    }
    if(newSched.length > 0) { S.schedule = newSched; schedDone = true; }
  }

  // ‚îÄ‚îÄ PLAYERS ‚Äî fusion des 3 sources (buts / passes / points) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const playerMap = {}; // cl√© = "Pr√©nom Nom"

  function normPlayerKey(p) {
    return ((p.firstName||'') + ' ' + (p.lastName||'')).trim().toLowerCase();
  }
  function toEmpirePlayer(p, sourceType) {
    const empireTeam = NHL_TRICODE_MAP[p.teamAbbrev] || p.teamAbbrev;
    const gp = p.gamesPlayed || 1;
    const name = ((p.firstName||'') + ' ' + (p.lastName||'')).trim();
    if(!name || !empireTeam) return null;
    return {
      n: name, t: empireTeam, nat:'CA', age: p.age||25,
      pos: mapNHLPos(p.positionCode),
      gp,
      g:   sourceType==='goals'   ? (p.goals||p.value||0)   : (p.goals||0),
      a:   sourceType==='assists' ? (p.assists||p.value||0)  : (p.assists||0),
      pts: sourceType==='points'  ? (p.points||p.value||0)   : (p.points||p.goals||p.assists||p.value||0),
      pim: p.penaltyMinutes||0, pm: p.plusMinus||0,
      ppg: p.powerPlayGoals||0,
      ratio: 0
    };
  }

  // Traite chaque source
  function mergeSource(list, sourceType) {
    for(const p of list) {
      const key = normPlayerKey(p);
      if(!key) continue;
      const ep = toEmpirePlayer(p, sourceType);
      if(!ep) continue;
      if(!playerMap[key]) {
        playerMap[key] = ep;
      } else {
        // Fusionne : prend la valeur non-nulle de chaque stat
        if(sourceType==='goals')   playerMap[key].g   = ep.g   || playerMap[key].g;
        if(sourceType==='assists') playerMap[key].a   = ep.a   || playerMap[key].a;
        if(sourceType==='points')  playerMap[key].pts = ep.pts || playerMap[key].pts;
      }
    }
  }

  // Source 1 : leaders/goals
  if(nhlData.goalLeaders.length > 0)   mergeSource(nhlData.goalLeaders,   'goals');
  // Source 2 : leaders/assists
  if(nhlData.assistLeaders.length > 0) mergeSource(nhlData.assistLeaders, 'assists');
  // Source 3 : leaders/points (prioritaire pour pts, et fallback buts/passes)
  if(nhlData.players.length > 0)       mergeSource(nhlData.players,       'points');

  // Calcule le ratio final et assemble
  const newPlayers = Object.values(playerMap).map(p => {
    p.pts = p.pts || (p.g + p.a);
    p.ratio = p.gp > 0 ? Math.round((p.pts/p.gp)*1000)/1000 : 0;
    return p;
  }).filter(p => p.n && p.t);

  let playersDone = false;
  if(newPlayers.length > 0) {
    S.players = [...newPlayers, ...S.players.filter(p => p.pos==='G')];
    playersDone = true;
  }

  // ‚îÄ‚îÄ Statut final ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const parts = [];
  if(standingsDone) parts.push('classement');
  if(schedDone)     parts.push(S.schedule.length + ' matchs');
  if(playersDone)   parts.push('joueurs');

  // Affiche un badge de statut vert discret dans le header
  let badge = document.getElementById('nhl-api-badge');
  if(!badge) {
    badge = document.createElement('span');
    badge.id = 'nhl-api-badge';
    badge.style.cssText='font-size:10px;letter-spacing:2px;padding:3px 10px;border-radius:5px;font-weight:700;transition:opacity .5s';
    const cnt = document.getElementById('upcoming-count');
    if(cnt && cnt.parentNode) cnt.parentNode.insertBefore(badge, cnt);
  }
  if(parts.length > 0) {
    badge.textContent = '‚úì ' + parts.join(' ¬∑ ');
    badge.style.color = '#00f5a0';
    badge.style.background = 'rgba(0,245,160,.1)';
    badge.style.border = '1px solid rgba(0,245,160,.3)';
    badge.style.opacity = '1';
    setTimeout(() => { badge.style.opacity = '0'; }, 4000);
  } else {
    badge.textContent = '‚ö† Donn√©es non pars√©es';
    badge.style.color = '#f0c84a';
    badge.style.background = 'rgba(240,200,74,.1)';
    badge.style.border = '1px solid rgba(240,200,74,.3)';
  }

  render();
  updateDashHeader();
}
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CLOCK & SNOWFLAKES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let clockInterval=null;
function startClock() {
  // Date syst√®me en fran√ßais ‚Äî jamais depuis l'API
  const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
  const dateLabel = new Date().toLocaleDateString('fr-FR', options);
  document.getElementById('current-date').textContent = dateLabel.charAt(0).toUpperCase() + dateLabel.slice(1);
  if(clockInterval) clearInterval(clockInterval);
  clockInterval=setInterval(()=>{
    const el=document.getElementById('dash-clock');
    if(el) el.textContent=new Date().toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  },1000);
  // D√©clenche imm√©diatement pour pas attendre 1s
  const el=document.getElementById('dash-clock');
  if(el) el.textContent=new Date().toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
}
(function(){
  const container=document.getElementById('snow');
  for(let i=0;i<20;i++) {
    const s=document.createElement('div');
    const size=Math.random()*10+4;
    s.textContent='‚ùÑ';
    s.style.cssText=`position:absolute;font-size:${size}px;color:rgba(77,217,245,${Math.random()*.15+.05});left:${Math.random()*100}%;top:-20px;animation:snowfall ${Math.random()*20+15}s linear ${Math.random()*15}s infinite;pointer-events:none`;
    container.appendChild(s);
  }
  const style=document.createElement('style');
  style.textContent='@keyframes snowfall{0%{transform:translateY(-20px) rotate(0deg)}100%{transform:translateY(110vh) rotate(360deg)}}';
  document.head.appendChild(style);
})();
// ‚îÄ‚îÄ Date syst√®me forc√©e au chargement ‚Äî ne d√©pend d'aucune donn√©e NHL ‚îÄ‚îÄ
(function(){
  const el = document.getElementById('current-date');
  if(el) el.innerText = new Intl.DateTimeFormat('fr-FR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' }).format(new Date());
})();
</script>
</body>
</html>
